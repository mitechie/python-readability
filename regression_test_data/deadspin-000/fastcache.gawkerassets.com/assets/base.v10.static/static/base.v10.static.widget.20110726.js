(function(a){a.widget("ui.AdRobot",{ptile:0,status:{},marquee_running:false,marquee_config:null,interstitial_running:false,previous_skin_css_url:"",queued_ads:{},debug_mode:false,initialize:function(){jQuery.writeCapture.writeOnGetElementById=true;jQuery.writeCapture.autoAsync();var b=this;jQuery(document).ready(function(){b.checkStickyPreview()})},checkStickyPreview:function(){var e=jQuery.cookie("GANJAFORCEVIEWDIR");if(e&&e!=="deleted"){var c=jQuery.cookie("GANJAFORCEVIEW");if(jQuery("#errorbar").length===0){var d=jQuery('<div id="errorbar" style="display: none;" />');d.append("This is a persistent skin preview for <strong>"+c+'</strong> showing on all pages. <a class="nocapture" href="/?op=takeover_preview&view=default">Click here to return to normal.</a><br />');d.append('Preview for this page only: <input id="skin_preview_url" type="text" value="" style="width: 400px;"/>');jQuery("body").prepend(d)}jQuery("#errorbar").show();jQuery("#main-container").addClass("skinpreview");jQuery("#skin_preview_url").val(document.location+"?view="+c);var b=e;this.setSkinCSS(b+this.options.takeover_css_name)}},setSkinCSS:function(b){if(this.skinNeedsToChange(b)||b===""){var c=jQuery("head .takeover_css");if(b===""){c.remove()}else{jQuery.cookie("interstitial_count",0,{path:"/"});if(c.length===0){jQuery("head").append('<link class="takeover_css" rel="stylesheet" type="text/css" href="'+b+'">')}else{c.eq(0).attr("href",b)}}this.previous_skin_css_url=b;return true}else{return false}},skinNeedsToChange:function(b){var c=jQuery(".takeover_css");if(c.length===1){var d=c.eq(0).attr("href").split("?");if(d[0]===b){return false}}if(b!==this.previous_skin_css_url){return true}return false},marqueeConfig:function(b){this.marquee_config=b},queueAdRun:function(c,b){this.queued_ads[c]=b},runAdFromQueue:function(c){if(!this.queued_ads[c]){return false}var b=jQuery("#ad_container_"+c);if(b.length>0){b.AdUnit(this.queued_ads[c]);delete this.queued_ads[c]}},showAdInfo:function(){var b={ad_random:"Random ID",size:"Size",zone:"Zone",keywords:"Keywords",hyperion_url:"Hyperion URL",dart_url:"DART URL",empty_ad:"Empty ad"};jQuery(".ad_container").each(function(g,f){var e=null;var c=[];var d=jQuery(f);var h=d.data("ad_info");if(d.prev("div .ad_info").length===0&&h!==undefined){for(e in b){if(b.hasOwnProperty(e)&&h[e]!==undefined){if(e.indexOf("_url")>=0){c.push("<strong>"+b[e]+'</strong>: <a href="'+h[e]+'">'+h[e]+"</a>")}else{c.push("<strong>"+b[e]+"</strong>: "+h[e])}}}d.before('<div class="ad_info" style="display: none;"></div>').prev("div .ad_info").html(c.join("<br />"))}});jQuery(".ad_info").toggle()},trackerTest:function(c){var b=0;var g={takeover:{label:"Takeover",selector:".ad_marquee .ad_container.takeover"},marquee:{label:"Marquee",selector:".ad_marquee .ad_container.marquee"},"7th_story":{label:"7th Story",selector:".sponsored_splash_post .ad_tracker-rightbar-sp .ad_container, #splashposts .post .ad_tracker-rightbar-sp .ad_container"},sidebar:{label:"Sidebar",selector:".rightbar_list .sponsored .ad_tracker-rightbar-sp .ad_container, #rightbar .sponsored .ad_tracker-rightbar-sp .ad_container"}};var e,d,f=null;for(d in g){if(g.hasOwnProperty(d)&&(c===undefined||c===d)){f=a(g[d].selector);for(b=0;b<f.length;b++){e=f.eq(b).data("ad_info");if(e!==undefined){if(c===undefined){this.logInfo(g[d].label+" Tracker",e)}else{return true}}}}}return false},logInfo:function(b,c){window.console.group(b);window.console.log("Size: "+c.size);window.console.log("DART URL: "+c.dart_url);window.console.log("Status: "+c.status);window.console.groupEnd()}});a.extend(a.ui.AdRobot,{version:"1.0",defaults:{adserver_host:"localhost:8800",controlClass:"ad_control",takeover_css_name:"style.css"}})}(jQuery));(function(a){a.widget("ui.AdminLogWidget",{initialize:function(){this.settings=[];this.xhr=new XHR({klass:"adminlog",success:this.handleAjaxSuccess.bind(this)});this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.page=0;this.showWidget()},showWidget:function(){this.loadData()},loadData:function(){var b={op:"commentadminstat",id:this.options.user_id,page:this.page};if(this.controls.indicator){this.controls.indicator.show()}this.xhr.send("/index.php",b)},handleClick:function(c){var b=this.getParam("cn",c.target);switch(b){case"next":this.page++;this.loadData();c.stopPropagation();c.preventDefault();break;case"prev":if(this.page>0){this.page--}this.loadData();c.stopPropagation();c.preventDefault();break}},handleAjaxSuccess:function(b){this.element.html(b.content);this.setControls();this.controls.indicator.hide()}});a.extend(a.ui.AdminLogWidget,{version:"1.0",defaults:{controlClass:"adminlogcontrol"}})})(jQuery);(function(a){a.widget("ui.AgeGate",{initialize:function(){var b=jQuery.cookie("visitor_birthdate");if(b!=null){parts=b.split("_");daysLeft=this.getDaysLeft(this.options.limit,parts[0],parts[1],parts[2]);if(daysLeft==0){var c=this.options.handler(this.options.object,this.options.id);jQuery("#"+this.options.id).get(0).innerHTML=c.output;
if(c.postShow!==undefined){c.postShow()}return true}else{jQuery("#"+this.options.id)[0].innerHTML=jQuery("#agegate_container_rejected")[0].innerHTML.replace(/IDHERE/,this.options.id);roundbox=jQuery("#agegate_"+this.options.id+" .roundbox")[0];roundbox.style.marginTop=Math.floor((this.options.object.height-roundbox.scrollHeight-10)/2)+"px"}}else{jQuery("#"+this.options.id)[0].innerHTML=jQuery("#agegate_container")[0].innerHTML.replace(/IDHERE/,this.options.id);this.setupForm()}jQuery("#agegate_"+this.options.id)[0].style.width=this.options.object.width+"px";jQuery("#agegate_"+this.options.id)[0].style.height=this.options.object.height+"px"},setupForm:function(){jQuery("INPUT.agegate_control").focus(function(){if(this.value==this.defaultValue){this.value=""}if(this.value!=this.defaultValue){this.select()}this.style.color="black"});jQuery("INPUT.agegate_control").blur(function(){if(a.trim(this.value)==""){this.value=(this.defaultValue?this.defaultValue:"");this.style.color="lightgrey"}});jQuery("INPUT.agegate_control").keypress(function(b){if((b.which>31&&b.which<48)||(b.which>57&&b.which<127)){return false}});roundbox=jQuery("#agegate_"+this.options.id+" .roundbox")[0];roundbox.style.marginTop=Math.floor((this.options.object.height-roundbox.scrollHeight-10)/2)+"px";this.setControls();this.registerEventHandler(this.controls.agegate_form,"submit",this.validateAge.bind(this));this.agegate_validator=new Validator(jQuery.extend({},{scope:this.controls.agegate_form}))},validateAge:function(b){this.agegate_validator.hideErrors();if(this.agegate_validator.validate()){year=this.controls.year[0].value;month=this.controls.month[0].value;day=this.controls.day[0].value;jQuery.cookie("visitor_birthdate",year+"_"+month+"_"+day);gates=GawkerClientside.widgets.agegate;for(i=0;i<gates.length;i++){daysLeft=this.getDaysLeft(gates[i].options.limit,year,month,day);if(daysLeft==0){var c=gates[i].options.handler(gates[i].options.object,gates[i].options.id);jQuery("#"+gates[i].options.id).get(0).innerHTML=c.output;if(c.postShow!==undefined){c.postShow()}}else{jQuery("#"+gates[i].options.id)[0].innerHTML=jQuery("#agegate_container_rejected")[0].innerHTML.replace(/IDHERE/,gates[i].options.id);jQuery("#agegate_"+gates[i].options.id)[0].style.width=gates[i].options.object.width+"px";jQuery("#agegate_"+gates[i].options.id)[0].style.height=gates[i].options.object.height+"px";roundbox=jQuery("#agegate_"+gates[i].options.id+" .roundbox")[0];roundbox.style.marginTop=Math.floor((gates[i].options.object.height-roundbox.scrollHeight-10)/2)+"px"}}}else{this.agegate_validator.showErrors()}b.stopPropagation();b.preventDefault()},getDaysLeft:function(b,d,e,c){now=new Date();birth=Date.UTC(d,e,c,0,0,0,0);nowyear=now.getYear();nowyear+=nowyear<1900?1900:0;start=Date.UTC((nowyear-b),now.getMonth()+1,now.getDate(),0,0,0,0);if(start>birth){daysLeft=0}else{daysLeft=Math.floor((birth-start)/(86400*1000))}return daysLeft}});a.extend(a.ui.AgeGate,{version:"1.0",defaults:{controlClass:"agegate_control"}})})(jQuery);(function(a){a.widget("ui.PromoteTweetWidget",{controls:{},params:{},xhr:null,initialize:function(){this.registerEventHandler(this.element,"click",this.handleClick.bind(this));var b=this;this.xhr=new XHR({klass:"promotetweet",beforeSend:function(c){b.handleAjaxRequest(c)},error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this))},showWidget:function(){jQuery(".content.tweets .commenttools").show()},hideWidget:function(){jQuery(".content.tweets .commenttools").hide();jQuery(".content.tweets .admin_links").hide()},authEventHandler:function(b){switch(b.name){case"user.auth.success":if(this.auth.hasLevel("authors")){this.showWidget()}else{this.hideWidget()}break;default:this.hideWidget();break}},handleClick:function(f){var b=jQuery(f.target);var d=this.getParam("tweetid",b);if(b.hasClass("cn_promote")){if(b.hasClass("hasPost")){var c="https://publish."+this.auth.site.canonicalHost.replace(/^([^\.]*\.)?([^\.]*\.[^\.]*)$/,"$2")+"/ged/"+this.getParam("postId",b);location.href=c}else{this.getUserList(d,this.getParam("tweetfeed",b))}f.stopPropagation();f.preventDefault()}else{if(b.hasClass("cn_closeadmin")){jQuery(".tweet_"+d+" .admin_links").hide();f.stopPropagation();f.preventDefault()}else{if(b.hasClass("cn_promotelink")){this.promoteTweet(d,this.getParam("userid",b),this.getParam("feed",b));f.stopPropagation();f.preventDefault()}}}},getUserList:function(c,b){this.xhr.send("/index.php",{op:"tweet_authorlist",tweetId:c,feed:b});this.showProgress(true,c)},promoteTweet:function(d,b,c){this.xhr.send("/index.php",{op:"tweet_bump",postId:d,feed:c,authorId:b});this.showProgress(true,d)},showProgress:function(b,c){if(!c){c=0}jQuery(".tweetPromoteProgress").appendTo((b?".comment.tweet.tweet_"+c+" .commenttools":"#tweetPromoteToolsContainer"))},handleAjaxRequest:function(){},handleAjaxSuccess:function(e){this.showProgress(false);switch(e.action){case"tweet_authorlist":var d=jQuery(".tweet_"+e.tweetId+" .admin_links");
d.empty();if(e.success){d.append('<span class="smallfont">Choose an author:</span> ');for(var c=0,b=e.users.length;c<b;c++){d.append('<a href="#" class="smallfont ptc cn_promotelink feed_'+e.feed+" tweetid_"+e.tweetId+" userid_"+e.users[c].id+'">'+e.users[c].name+"</a> ")}d.append('<a href="#" class="ptc tweetid_'+e.tweetId+' cn_closeadmin closeButton">x</a>');d.show()}break;case"tweet_promote":jQuery(".tweet_"+e.tweetId+" .admin_links").hide();if(e.success){jQuery(".cn_promote.tweetid_"+e.tweetId).addClass("hasPost");jQuery(".cn_promote.tweetid_"+e.tweetId).removeClass("noPost");jQuery(".cn_promote.tweetid_"+e.tweetId).addClass("postId_"+e.postId)}else{jQuery(".tweet_"+e.tweetId+" .admin_message").text("Twetter promotion failed. Please try again.");jQuery(".tweet_"+e.tweetId+" .admin_message").show()}break}},handleAjaxFail:function(){this.showProgress(false)}});a.extend(a.ui.PromoteTweetWidget,{version:"1.0",defaults:{action_url:"/index.php",controlClass:"ptc"}})})(jQuery);(function(a){a.widget("ui.ChartbeatWidget",{xhr:null,pulseHost:"",links:[],interval:5,runChartbeat:true,initialize:function(){var b=this;this.xhr=new XHR({klass:"chartbeat",type:"POST",beforeSend:function(c){b.handleAjaxRequest(c)},error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});this.pulseHost=this.options.host;this.interval=this.options.interval;this.runChartbeat=this.options.runChartbeat;if(!this.interval||!this.pulseHost){this.runChartbeat=false}if(this.runChartbeat){this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this));this.subscribeForEvent("navigation.loaded",this.parseChartbeatLinks.bind(this));this.subscribeForEvent("chartbeat.iterationFinished",this.runNextCheck.bind(this));this.subscribeForEvent("navigation.load",this.suspendChartbeat.bind(this));this.subscribeForEvent("maincontent.postloaded",this.resumeChartbeat.bind(this));this.subscribeForEvent("maincontent.frontpageloaded",this.resumeChartbeat.bind(this));this.parseChartbeatLinks();this.waitingForNextCheck=false;this.chartbeatSuspended=false;this.runNextCheck();this.animationQueue=0}},authEventHandler:function(b){},handleClick:function(b){},handleAjaxRequest:function(){},parseHost:function(c){if(this.hostCache===undefined){this.hostCache={}}if(this.hostCache[c]===undefined){var b=new RegExp("([^.]+).[^.]+$").exec(c);if(b===null){return c}this.hostCache[c]=b[1]+".com"}return this.hostCache[c]},parseChartbeatLinks:function(){var b=[];var c={host:this.parseHost(location.host),path:location.pathname};var c={host:this.parseHost(location.host),path:"null"};b.push(c);var d=this;jQuery("a.liveData").each(function(f){var g="";var h="";if(this.cbHost!==undefined){g=this.cbHost;h=this.cbPath}else{var e=new RegExp("https?://([^/]+)(.*)").exec(this.href);if(e!==null){g=d.parseHost(e[1]);h=e[2];this.cbHost=g;this.cbPath=h}}c={host:g,path:h};b.push(c)});this.links=b},runNextCheck:function(){if(this.waitingForNextCheck){return}this.waitingForNextCheck=true;var b=this;setTimeout(function(){b.waitingForNextCheck=false;if(b.runChartbeat&&!this.chartbeatSuspended){b.getChartbeatData(b.links,location.host)}else{this.raiseEvent("chartbeat.iterationFinished",{})}},this.interval*1000)},getChartbeatData:function(g,b){b=this.parseHost(b);var c=[];var h={host:[],path:[],op:"ajax_remoteservice",type:"chartbeat"};for(var d=0;d<g.length;d++){var f=g[d];var e=b;if(f.host!==undefined){e=f.host}h.host.push(e);h.path.push(f.path)}this.xhr.send("index.php",h)},showChartbeatData:function(e){var l={};for(var f=0;f<e.length;f++){var j=e[f];if(j.path===null){j.path=""}if(l[j.host]===undefined){l[j.host]={}}l[j.host][j.path]={"new":j["new"],"return":j["return"],people:j["new"]+j["return"]}}var d=this;jQuery("a.liveData").each(function(n){if(this.cbHost!==undefined){var r=this.cbHost;var m=this.cbPath.replace("+"," ");if(l[r]===undefined){return true}var o=l[r][m];if(o!==undefined){var q=d.getParam("liveData",jQuery(this));if(q!==null){d.setNumber(".liveDataContainer_"+q,o.people)}else{var p=o["new"]+" new and "+o["return"]+" returning visitor";this.title=p}}}});var k=this.parseHost(location.host);if(l[k][""]!==undefined){var g=l[k][""]["people"];this.setNumber("#siteVisitors",g);var b=parseInt(jQuery("#siteVisitorRatio").css("width").replace("%",""),10);var c=Math.round(l[k][""]["new"]/l[k][""]["people"]*100-3);if(b!=c){var h=(c>b?"+":"-")+"="+Math.abs(c-b)+"%";jQuery("#siteVisitorRatio").animate({width:h},"normal")}}if(!this.waitingForNextCheck&&this.animationQueue==0){this.runNextCheck()}},setNumber:function(j,f){var d=jQuery(j);if(d.length==0||f<1){return}var c=parseInt(d.html().replace(",",""),10);var h=Math.abs(f-c);if(h==0){return}var e=1;if(h>100){e=Math.ceil(h/100)}var g=(f>c);e=e*(g?1:-1);this.animationQueue++;var b=(d.attr("id").length>0?d.attr("id"):d.attr("class"));if(g){d.closest(".viewer-count").removeClass("trendingDown").addClass("trendingUp")}else{d.closest(".viewer-count").removeClass("trendingUp").addClass("trendingDown")
}this.changeNumber(c+e,f,g,e,d)},changeNumber:function(l,m,f,d,b){try{if((f&&l>m)||(!f&&l<m)){l=m}var j=l+"";var c=/(\d+)(\d{3})/;while(c.test(j)){j=j.replace(c,"$1,$2")}b.html(j);var h=this;if((f&&l<m)||(!f&&l>m)){setTimeout(function(){h.changeNumber((l+d),m,f,d,b)},5)}else{this.animationQueue--;var g=(b.attr("id").length>0?b.attr("id"):b.attr("class"));if(this.animationQueue==0){this.raiseEvent("chartbeat.iterationFinished",{})}}}catch(k){this.animationQueue--}},suspendChartbeat:function(){this.chartbeatSuspended=true},resumeChartbeat:function(){this.chartbeatSuspended=false},handleAjaxSuccess:function(b){this.showChartbeatData(b)},handleAjaxFail:function(){}});a.extend(a.ui.ChartbeatWidget,{version:"1.0",defaults:{action_url:"/index.php",controlClass:"chartbeat_control"}})})(jQuery);(function(b){var a=b.extend({},{login_state:"loggedout:idle",mode:"commentform",initialize:function(){this.subscribeForEvent("user.",this.authEventHandler.bind(this));this.subscribeForEvent("navigation.load",this.navigationEventHandler.bind(this));this.subscribeForEvent("commentform.",this.eventHandler.bind(this));this.subscribeForEvent("maincontent.postloaded",this.postEventHandler.bind(this));this.subscribeForEvent("maincontent.forumloaded",this.forumEventHandler.bind(this));this.registerEventHandler(this.controls.submit,"click",this.handleSubmit.bind(this));this.registerEventHandler(this.controls.cancel,"click",this.handleCancel.bind(this));this.registerEventHandler(this.controls.switchtab,"click",this.handleSwitchTab.bind(this));this.registerEventHandler(this.controls.postform,"submit",this.handleSubmit.bind(this));this.registerEventHandler(this.controls.image_url,"change",this.handleImagePreview.bind(this));this.registerEventHandler(this.controls.video_url,"change",this.handleVideoPreview.bind(this));this.registerEventHandler(this.controls.select_image_url,"click",this.setImageUrlForm.bind(this));if(this.controls.select_image_upload!==undefined){this.registerEventHandler(this.controls.select_image_upload,"click",this.setImageUploadForm.bind(this))}this.xhr=new XHR({klass:"commentform",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)})},authEventHandler:function(c){switch(c.name){case"user.auth.success":if(this.login_state=="loggedout:submit"){this.login_state="loggedin:idle";this.handleSubmit({})}this.login_state="loggedin:idle";this.controls.op.val("addcomment");this.controls.anonemailinput.val("");this.controls.anonnewsletter.val("");this.showFormUser();break;case"user.auth.failure":this.login_state="loggedout:idle";this.hideFormUser();break;case"user.emailcomment":this.login_state="guest:submit";break}},navigationEventHandler:function(c){if(c.name=="navigation.load"){this.hideForm()}},handleSubmit:function(d){if(this.login_state=="loggedout:idle"||this.login_state=="loggedout:submit"){this.login_state="loggedout:submit";this.raiseEvent("presence.requiresequence.guest",{});d.stopPropagation();d.preventDefault();return false}if(!jQuery.browser.msie){this.controls.entry_preview.html(this.controls.entry.val());this.controls.entry.val(this.controls.entry_preview.html())}var c=this.controls.postform.serializeArray();if(window.pageType==="site_comments_admin"){c.push({name:"external_tools",value:true})}this.xhr.send("/index.php",c);d.stopPropagation();d.preventDefault()},handleAjaxRequest:function(){this.controls.submit.attr("disabled","disabled");this.controls.cancel.attr("disabled","disabled");this.controls.indicator.show()},handleAjaxSuccess:function(c){this.controls.submit.attr("disabled","");this.controls.cancel.attr("disabled","");this.controls.indicator.hide();if(c.code!==undefined&&c.code==="ACCESS_DENIED"){c.message="You don't have the permission to comment on this site"}switch(c.action){case"addcomment":case"addguestcomment":if(c.success===true){this.hideForm();this.resetFormValues();if(c.action==="addguestcomment"){var d=jQuery(c.content);jQuery(".metatext",d).html('<span class="msghighlited">(Comment Pending. Please check your email for a verification link.)</span>');c.content=d.html()}this.raiseEvent("threads.insertcomment",{comment:c});if(c.message!==undefined){Message.showMessage(c.message,this.controls.message[0],{stable:false,onShow:function(){this.controls.message.show()}.bind(this),onComplete:function(){this.controls.message.hide()}.bind(this)})}}else{if(c.message!==undefined){Message.showMessage(c.message,this.controls.message[0],{stable:false,onShow:function(){this.controls.message.show()}.bind(this),onComplete:function(){this.controls.message.hide()}.bind(this)})}}Debug.log({mode:"AJAX",url:"op:addcomment-ajaxsuccess",options:{data:c}});break;case"editcomment":if(c.success){this.raiseEvent("threads.replacecomment",{comment:c});this.raiseEvent("commentform.close",{});this.resetFormValues();this.setMode()}else{Message.showMessage("Comment edit failed",this.controls.message[0],{stable:false,onShow:function(){this.controls.message.show()
}.bind(this),onComplete:function(){this.controls.message.hide()}.bind(this)})}break}},handleAjaxFail:function(c){this.controls.indicator.hide();this.controls.submit.attr("disabled","");this.controls.cancel.attr("disabled","");Message.showMessage("Comment save failed",this.controls.message[0],{stable:false,duration:3000,onShow:function(){this.controls.message.show()}.bind(this),onComplete:function(){this.controls.message.hide()}.bind(this)});Debug.log({mode:"AJAX",url:"op:addcomment-ajaxfail",options:{data:arguments}})},handleCancel:function(c){this.resetFormValues();this.setMode();this.raiseEvent("commentform.close",{refresh_thread:false});this.raiseEvent("commentform.cancel",{});c.stopPropagation();c.preventDefault()},handleSwitchTab:function(c){if(this.controls.expandedform.is(":visible")===false){this.expandForm(true)}var d=this.getParam("t",c.target);this.switchtab(d,true);c.stopPropagation();c.preventDefault()},handleImagePreview:function(c){return false},handleVideoPreview:function(c){return false},expandForm:function(c){if(c){this.controls.expandedform.show();this.element.addClass("opened")}else{this.controls.expandedform.hide();this.controls.image_upload_external.hide();this.element.removeClass("opened")}},openForm:function(c){this.element.fadeIn("normal",function(){this.switchtab("text",null,c)}.bind(this))},hideForm:function(){if(this.mode=="postform"){this.expandForm(false);jQuery(".postform_container").append(this.element)}else{this.element.hide();this.resetFormValues();jQuery(".commentform_container").append(this.element)}},switchtab:function(f,e,c){if(false&&e){var d=false;jQuery(this.options.fields).each(function(g,h){var j=this.controls[h].val();if(this.controls[h].is("SELECT")!==true&&j!==""){d=true}}.bind(this));if(d){if(!window.confirm("Unsaved changes, do you want to clear data?")){return false}}}this.controls.mode.val(f);jQuery(".tabs li").removeClass("selected");jQuery(".tabs li.t_"+f).addClass("selected");jQuery(".tabs li.t_"+f).closest(".form_part").removeClass("pf_text pf_image pf_video pf_quote").addClass("pf_"+f);jQuery(["tab","extension"]).each(function(g,h){jQuery("."+h+"").hide();jQuery("."+h+".t_"+f).show()});if(jQuery("textarea:visible, input:visible",this.element).get(0)&&!c){jQuery("textarea:visible, input:visible",this.element).get(0).focus()}this.controls.expandedform.removeClass("preview_shown")},resetFormValues:function(){var c=["parent_id","comment_id","entry","quote","image_file","image_url","image_format","image_upload","comment_id","video_url","quote_url","anonemailinput","anonnewsletter"];jQuery(c).each(jQuery.proxy(function(f,h){try{this.controls[h].val("")}catch(g){}},this));try{this.controls.fileuploadform.fileUpload("destroy","comment_image_upload")}catch(d){}},eventHandler:function(c){switch(c.name){case"commentform.open":this.openWidget(c.params);break;case"commentform.setreplyto":this.setReplyto(c.params);break;case"commentform.setedit":this.setEdit(c.params);break;case"commentform.close":case"commentform.cancel":this.hideForm();break;case"commentform.guestsubmit":this.setMode("guest",c.params);this.controls.postform.submit();break;case"commentform.guestcancel":this.setMode("normal",c.params);break}},postEventHandler:function(c){if(c.name=="maincontent.postloaded"){this.mode="commentform";this.controls.root_id.val(c.params.data.id);this.controls.sitetag.val("")}},forumEventHandler:function(c){if(c.name=="maincontent.forumloaded"){this.mode="postform";this.controls.root_id.val(c.params.data.sitetag.id);this.controls.sitetag.val(c.params.data.sitetag.name);this.openWidget({after:jQuery(".postform_container"),dont_expand_form:false})}},refreshWidget:function(){this.setControls();if(this.auth.authenticated&&this.auth.user.fb_uid){jQuery(".fbuser").show()}else{jQuery(".fbuser").hide()}},openWidget:function(d){var c=null;if(d.after!==undefined){c=d.after}else{c=jQuery(".input_box_place")}c.after(this.element);if(d.clear!==undefined&&d.clear===true){this.resetFormValues()}if(d.dont_expand_form===undefined||d.dont_expand_form!==true){this.expandForm(true);this.openForm(d.nofocus)}else{this.expandForm(false)}this.openForm(d.nofocus);this.controls.entry.autogrow();this.raiseEvent("commentform.opened",{})},setReplyto:function(c){this.controls.parent_id.val(c.replyto);this.controls.comment_id.val("");this.controls.entry.get(0).focus()},setEdit:function(c){var d=new XHR({klass:"getcomment",beforeSend:function(){},error:function(){},success:function(f){if(f.success===true){this.setMode("edit",{comment:f});var g=jQuery(".cid_"+f.comment_id).hide();this.openWidget({after:g,dont_expand_form:false,clear:false})}else{var e=jQuery(".cid_"+f.comment_id+" .please_leave_a_message");Message.showMessage("Comment read failed",e.get(0),{stable:false})}}.bind(this)});d.send("/index.php",{op:"ajax_getcomment",id:c.comment_id})},setMode:function(d,c){switch(d){case"guest":this.controls.op.val("addguestcomment");this.login_state="guest:submit";this.controls.anonemailinput.val(c.email);this.controls.anonnewsletter.val(c.newsletter);
break;case"author":this.controls.op.val("postauthorcomment");break;case"edit":this.controls.op.val("editcomment");this.controls.comment_id.val(c.comment.comment_id);this.controls.parent_id.val(c.comment.parent_id);this.controls.entry.val(c.comment.original_text);break;default:this.controls.op.val("addcomment");this.controls.anonemailinput.val("");this.controls.anonnewsletter.val("");break}},showFormUser:function(){if(this.auth.authenticated){this.controls.author_link.attr({href:"/people/"+this.auth.user.username});this.controls.author_link.text(this.auth.user.smartName).show();this.controls.author_image.attr({src:"http://cache.gawkerassets.com/assets/images/commenter/"+this.auth.user.avatarPath+"_32.jpg"}).show()}},hideFormUser:function(){this.controls.author_link.attr({href:"#"}).hide();this.controls.author_link.text("").hide();this.controls.author_image.attr({src:"http://cache.gawkerassets.com/assets/images/commenter/noimage.gif"}).hide()},setImageUploadForm:function(c){c.stopPropagation();c.preventDefault();this.controls.image_url_wrap.hide();this.controls.image_upload_wrap.show();this.controls.fileuploadform.fileUpload({namespace:"comment_image_upload",url:"/index.php",method:"POST",fieldName:"image_upload",formData:{op:"comment_image_upload"},multiFileRequest:false,initUpload:function(g,f,d,j,e,h){this.controls.image_upload_result.html("please wait");h()}.bind(this),onLoad:function(h,g,d,j,f){if(j.statusText=="OK"){var e=jQuery.parseJSON(j.responseText);if(e.success===true){this.controls.image_file.val(e.path);this.controls.image_format.val(e.format);Message.showMessage("Image uploaded",this.controls.image_upload_result[0],{stable:false,onComplete:function(){this.controls.image_upload_result.html('<a href="'+e.thumb+'" target="_new">View image</a>')}.bind(this)})}else{this.controls.image_file.val("");this.controls.image_upload_result.html("");if(e.message!==undefined){Message.showMessage(e.message,this.controls.image_upload_result[0],{stable:false})}}}}.bind(this)})},setImageUrlForm:function(c){c.stopPropagation();c.preventDefault();this.controls.image_upload_wrap.hide();this.controls.image_url_wrap.show();this.controls.fileuploadform.fileUpload("destroy","comment_image_upload")}});b.widget("ui.CommentFormWidget",a);b.extend(b.ui.CommentFormWidget,{version:"1.0",defaults:{onHide:{},onShow:{},onReset:{},controlClass:"pfc",externalElement:"",show_validation_errors:true}})})(jQuery);(function(a){a.widget("ui.CommenterWidget",{initialize:function(){this.xhr=new XHR({klass:"commenter",type:"POST",beforeSend:this.ajaxRequestHandler.bind(this),error:this.ajaxFailHandler.bind(this),success:this.ajaxSuccessHandler.bind(this)});this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.subscribeForEvent("threads.threadloaded",this.eventThreadLoadedHandler.bind(this));this.subscribeForEvent("threads.listloaded",this.eventThreadLoadedHandler.bind(this));this.subscribeForEvent("maincontent.profilepageloaded",this.eventThreadLoadedHandler.bind(this));this.subscribeForEvent("maincontent.forumloaded",this.eventThreadLoadedHandler.bind(this));this.subscribeForEvent("user.auth.",this.eventAuthHandler.bind(this))},eventThreadLoadedHandler:function(b){this.resetElements();this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.setControls();this.showIcons()},eventAuthHandler:function(b){this.showIcons()},handleClick:function(d){var c=jQuery(d.target);var f=this.getParam("cn",c);var b=this.getParam("bid",c);switch(f){case"buddy":this.toggleBuddy(b);d.stopPropagation();d.preventDefault();break;case"ffbox_toggle":this.toggleFriendsBox();d.stopPropagation();d.preventDefault();break}},ajaxRequestHandler:function(){},ajaxSuccessHandler:function(d){switch(d.action){case"saveusertag":if(d.objectId!==undefined){this.controls.buddy.filter(".bid_"+d.objectId+".inprogress").removeClass("inprogress")}if(d.success===true){if(d.command=="tag"){this.auth.user.buddies.push(d.objectId)}else{var b=this.auth.user.buddies.indexOf(d.objectId);var e=[];for(var c=0;c<this.auth.user.buddies.length;c++){if(c!=b){e.push(this.auth.user.buddies[c])}}this.auth.user.buddies=e}this.auth.resetRevision();this.showIcons()}break;case"ajax_buddylist":this.controls.ffbox_placeholder.html(d.content).slideDown();this.eventThreadLoadedHandler({});break}},ajaxFailHandler:function(b){this.controls.buddy.filter(".inprogress").removeClass("inprogress")},showIcons:function(){if(this.controls.buddy===undefined){return false}if(this.auth.authenticated){this.controls.buddy.show()}else{this.controls.buddy.hide();return false}this.controls.buddy.removeClass("buddy_true");var b=null;this.controls.buddy.each(function(c,d){b=this.getParam("bid",d);if(this.auth.user.buddies.indexOf(b)!==-1){jQuery(d).addClass("buddy_true")}}.bind(this))},toggleBuddy:function(c){var b={op:"saveusertag",objectType:"USER",objectId:c};if(jQuery.inArray(c,this.auth.user.buddies)===-1){b.tagName="buddy"}else{b.unTagName="buddy"}this.controls.buddy.filter(".bid_"+c).addClass("inprogress");
this.xhr.send(this.options.action_url,b)},toggleFriendsBox:function(){if(this.controls.ffbox_wrapper.hasClass("opened")){this.controls.ffbox_placeholder.slideUp("fast");this.controls.ffbox_wrapper.removeClass("opened")}else{this.controls.ffbox_wrapper.addClass("opened");if(this.controls.ffbox_placeholder.html()===""){var b=this.getParam("userid",this.controls.ffbox_wrapper);var c={op:"ajax_buddylist",user_id:b};this.xhr.send(this.options.action_url,c)}else{this.controls.ffbox_placeholder.slideDown()}}}});a.extend(a.ui.CommenterWidget,{version:"1.0",defaults:{action_url:"/index.php",onHide:{},onShow:{},onReset:{},controlClass:"cw",externalElement:"#comments, .user-profile, .biguserlist, .userlist"}})})(jQuery);(function(a){a.widget("ui.CommenterAdminWidget",{controls:{},has_admin_rights:false,initialize:function(){this.xhr=new XHR({klass:"commenteradmin",type:"POST",beforeSend:this.ajaxRequestHandler.bind(this),error:this.ajaxFailHandler.bind(this),success:this.ajaxSuccessHandler.bind(this)});this.subscribeForEvent("commenteradmin.",this.eventHandler.bind(this));this.subscribeForEvent("threads.",this.eventThreadLoadedHandler.bind(this));this.subscribeForEvent("user.auth.",this.eventAuthHandler.bind(this));this.registerEventHandler(this.element,"click",this.handleClick.bind(this))},eventHandler:function(b){switch(b.name){case"commenteradmin.setstar":this.setStarStatus({commenter_id:b.params.commenter_id,star:b.params.star,comment_id:b.params.comment_id});break;case"commenteradmin.starset":this.userStarredHandler(b.params);break;case"commenteradmin.changestate":this.setUserState({commenter_id:b.params.commenter_id,state:b.params.state,comment_id:b.params.comment_id});break;case"commenteradmin.statechanged":this.userStateChangeHandler(b.params);break}},eventThreadLoadedHandler:function(b){if(b.name=="threads.listloaded"){this.loadControls()}},eventAuthHandler:function(b){this.setUserRights()},handleClick:function(f){var d=jQuery(f.target);var j=this.getParam("cn",d);var h=d.closest(".comment");var g=this.getParam("aid",h);var c=this.getParam("cid",h);if(!this.has_admin_rights){f.stopPropagation();f.preventDefault();return false}switch(j){case"approveuser":this.raiseEvent("commenteradmin.changestate",{commenter_id:g,state:"approve",comment_id:c});jQuery(".admin_links",h).hide();f.stopPropagation();f.preventDefault();break;case"togglestar":var b=(this.getParam("s",d)=="t")?true:false;this.raiseEvent("commenteradmin.setstar",{commenter_id:g,star:b,comment_id:c});f.stopPropagation();f.preventDefault();break;case"adminpage":document.location="/index.php?op=userlist_search&id="+g+"&siteId="+siteConfig.id;jQuery(".admin_links",h).hide();f.stopPropagation();f.preventDefault();break;case"toggleadminlinks":jQuery(".admin_links",h).toggle();f.stopPropagation();f.preventDefault();break}},ajaxRequestHandler:function(){},ajaxSuccessHandler:function(b){var c={};switch(b.action){case"setstarcommenter":if(b.success===true){c={commenter_id:b.commenterId,comment_id:b.commentId,star:b.starcommenter};this.raiseEvent("commenteradmin.starset",c)}break;case"approveuser":if(b.success===true){c={commenter_id:b.commenterId,comment_id:b.commentId,state:b.action.slice(0,-4)};this.raiseEvent("commenteradmin.statechanged",c)}break}},ajaxFailHandler:function(b){},setUserRights:function(){if(!this.auth.authenticated||!this.auth.hasLevel("commentadmins")){this.element.find(".cn_togglestar.s_t").css({display:"none"});this.has_admin_rights=false}else{if(this.auth.hasLevel("commentadmins")){this.element.find(".cn_togglestar").css({display:"block"});this.has_admin_rights=true}}},loadControls:function(){this.tearDownEventHandler(this.element,"click",this.handleClick.bind(this));this.resetElements();this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.setControls();this.setUserRights()},setStarStatus:function(c){if(typeof c!=="object"||c.commenter_id===undefined){return false}if(c.star===undefined){c.star=true}var b={op:"setstarcommenter",id:c.commenter_id,starcommenter:c.star,cid:c.comment_id,siteId:siteConfig.id};this.xhr.send(this.options.action_url,b)},userStarredHandler:function(b){if(typeof b!=="object"||b.commenter_id===undefined){return false}if(b.star===true){this.element.find(".aid_"+b.commenter_id+" .cn_togglestar").removeClass("s_t").addClass("s_f")}else{if(b.star===false){this.element.find(".aid_"+b.commenter_id+" .cn_togglestar").removeClass("s_f").addClass("s_t")}}this.raiseEvent("threadadmin.priorityset",{comment_id:b.comment_id,priority:(b.starcommenter===true)?0:1});this.raiseEvent("threadadmin.messageadd",{comment_id:b.comment_id,type:"starredBy",message:"%user starred by %another user"})},setUserState:function(c){if(typeof c!=="object"||c.commenter_id===undefined){return false}var b={op:"changeuserstatus",action:"approve",id:c.commenter_id,siteId:siteConfig.id,commentId:c.comment_id,reloadGroups:true};this.xhr.send(this.options.action_url,b)},userStateChangeHandler:function(b){this.element.find(".aid_"+b.commenter_id+".us_pending").removeClass("us_pending");
this.raiseEvent("threadadmin.commentapproved",{comment_id:b.comment_id});this.raiseEvent("threadadmin.messageadd",{comment_id:b.comment_id,type:"approvedBy",message:"%user approved by %another user"})}});a.extend(a.ui.CommenterAdminWidget,{version:"2.0",defaults:{action_url:"/index.php",onHide:{},onShow:{},onReset:{},controlClass:"cra",externalElement:"#comments, .postlist"}})})(jQuery);(function(a){a.widget("ui.Marquee",{marquee_running:false,initialize:function(){jQuery(document).trigger("ad.marquee.init",{});if(this.options.view_name!="default"){this.triggerTracker(0)}if(this.options.marquee_should_run===true){this.marquee_running=true;window.adRobot.marquee_running=true;jQuery("body").addClass("marqueed");this.injectMarquee();if(this.options.frequency_limit_on===true){if(this.options.frequency!==undefined&&this.options.frequency>0){jQuery.cookie("marquee_shown_"+this.options.view_name,1,{expires:(this.options.frequency/24),path:"/"})}}jQuery(document).bind("ad.marquee.finished",jQuery.proxy(this.marqueeFinished,this));jQuery(this.element).css({height:this.options.height+"px",width:this.options.width+"px"});this.triggerTracker(1)}else{jQuery("body").removeClass("marqueed")}},triggerTracker:function(b){var d=jQuery(".ad_container",jQuery(".ad_marquee")).eq(b);var c=d.attr("id").replace("ad_container_","");adRobot.runAdFromQueue(c)},destroy:function(){jQuery(document).unbind("ad.marquee.finished")},injectMarquee:function(){AC_FL_RunContent("codebase","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0","width",this.options.width,"height",this.options.height,"src",this.options.swfFile,"quality","high","pluginspage","http://www.adobe.com/go/getflashplayer","align","middle","play","true","loop","true","scale","showall","wmode","transparent","devicefont","false","id","RSSTicker_gawker","bgcolor","transparent","name","RSSTicker_gawker","menu","true","allowFullScreen","false","allowScriptAccess","always","movie",this.options.swfFile,"salign","","insertinto",this.element.attr("id"))},marqueeFinished:function(c,b){if(b!==undefined&&b.force!==undefined&&b.force===true){this.showIllustration(true)}else{this.showIllustration()}},showIllustration:function(b){if(b===true||this.marquee_running===false){this.marquee_running=false;jQuery(".ad_marquee").hide();jQuery("#aboveheadlinevideo object").show();jQuery(".marqueed").removeClass("marqueed")}}});a.extend(a.ui.Marquee,{version:"1.0",defaults:{controlClass:"mc"}})}(jQuery));function marqueeCalled(){}function marquee_finished(){window.adRobot.marquee_running=false;jQuery(document).trigger("ad.marquee.finished",{force:true})}(function(a){a.widget("ui.MessagingWidget",{controls:{},initialize:function(){this.subscribeForEvent("maincontent.profilepageloaded",this.eventPageLoadedHandler.bind(this));this.validator=new Validator(jQuery.extend({},{scope:this.controls.form}));this.xhr=new XHR({klass:"messaging",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this))},handleSubmit:function(b){this.validator.hideErrors();if(this.validator.validate()){this.xhr.send(this.options.action_url,{op:"postmessage",messageText:this.controls.text.val(),attachedObjId:this.controls.attachedObjId.val(),sentToId:this.controls.sentToId.val(),status:((this.controls.public_message.get(0).checked)?"PUBLIC":"PRIVATE")})}else{if(this.options.show_validation_errors){this.validator.showErrors()}}b.preventDefault();b.stopPropagation();return false},handleClick:function(f){var d=jQuery(f.target);var h=this.getParam("cn",d);switch(h){case"openform":this.controls.form.slideDown("fast");f.preventDefault();f.stopPropagation();break;case"cancel":this.controls.form.slideUp("fast",jQuery.proxy(function(){this.resetForm()},this));f.preventDefault();f.stopPropagation();break;case"submit":this.controls.form.submit();f.preventDefault();f.stopPropagation();break;case"delete":var b=jQuery(f.target).data("messageid");if(b===undefined){break}this.deleteMessage(b);f.preventDefault();f.stopPropagation();break;case"reply":f.preventDefault();f.stopPropagation();var c=jQuery(f.target).data("replyid");var g=jQuery(f.target).data("replyuserid");if(c===undefined||g===undefined){break}jQuery("#message_"+c+" .form_place").after(this.controls.form);this.controls.attachedObjId.val(c);this.controls.sentToId.val(g);this.controls.form.slideDown("fast");break}},eventPageLoadedHandler:function(b){this.resetElements();this.setControls();this.registerEventHandler(this.controls.form,"submit",this.handleSubmit.bind(this));this.registerEventHandler(this.element,"click",this.handleClick.bind(this))},handleAjaxRequest:function(){this.controls.indicator.show()},handleAjaxSuccess:function(c){switch(c.action){case"postmessage":if(c.success===true){Message.showMessage("Message sent.",this.controls.message[0],{stable:false,onComplete:function(){this.controls.form.slideUp("fast",jQuery.proxy(function(){this.resetForm()
},this))}.bind(this)})}this.controls.indicator.hide();break;case"changemessagestatus":if(c.success===true){var b=jQuery("#message_"+c.messageId);jQuery(".icon_progress",b).show();Message.showMessage("Post deleted",jQuery(".messagetext",b).get(0),{stable:false,onComplete:function(){b.next("hr").remove();b.remove()}.bind(this,b)})}break}},handleAjaxFail:function(){var b="Error occurred, please try again later.";Message.showMessage(b,this.controls.message[0]);this.controls.indicator.hide()},authEventHandler:function(b){if(this.auth.authenticated){this.controls.openform.show()}else{this.controls.openform.hide()}},resetForm:function(){this.controls.text.val("");this.controls.attachedObjId.val("");this.controls.public_message.get(0).checked=false;this.controls.form_default_place.after(this.controls.form)},deleteMessage:function(c){var b={op:"changemessagestatus",publishStatus:"DELETED",id:c};if(window.confirm("Are you sure you want to delete this message?")){jQuery("#message_"+c+" .icon_progress").show();this.xhr.send(this.options.action_url,b)}}});a.extend(a.ui.MessagingWidget,{version:"0.1",defaults:{action_url:"/index.php",controlClass:"mw",externalElement:".commenter_messaging_external, .commenter_tools, .userlist"}})})(jQuery);(function(a){a.widget("ui.PostStatusToggler",{xhr:null,initialize:function(){this.xhr=new XHR({klass:"post_status_toggler",success:this.promoteSuccess.bind(this),error:this.ajaxFailure.bind(this)});this.registerEventHandler(this.element,"click",this.handleStatusToggleClick.bind(this));this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this))},authEventHandler:function(b){switch(b.name){case"user.auth.success":this.showWidget();break;case"user.auth.failure":this.hideWidget();break}},handleStatusToggleClick:function(c){var b=jQuery("a",c.target);if(b.hasClass(this.options.classes.promote)){c.stopPropagation();c.preventDefault();this.promoteItem(b.parent())}else{if(b.hasClass(this.options.classes.demote)){c.stopPropagation();c.preventDefault();this.demoteItem(b.parent())}else{if(b.hasClass(this.options.classes.sitetag)){c.stopPropagation();c.preventDefault();this.removeSiteTag(b.parent())}}}},getPostInfo:function(d,b){var c={el:d,id:this.getParam(this.options.prefixes["postid"],d)};if(b){c.realm=this.getParam(this.options.prefixes["postrealm"],d)}else{c.issued=this.getParam(this.options.prefixes["postissued"],d)}c.message=jQuery(".cn_message",d.parent());c.indicator=jQuery(".cn_indicator",d.parent());return c},promoteItem:function(b){this.context=this.getPostInfo(b,true);this.context.addclass="demote";this.context.removeclass="promote";this.context.indicator.show();this.xhr.send(this.options.promote_url,{id:this.context.id,publishStatus:"PUBLISHED",realm:this.context.realm})},demoteItem:function(b){this.context=this.getPostInfo(b,true);this.context.addclass="promote";this.context.removeclass="demote";this.context.indicator.show();this.xhr.send(this.options.promote_url,{id:this.context.id,publishStatus:"REVIEWED",realm:this.context.realm})},removeSiteTag:function(b){this.context=this.getPostInfo(b,false);this.context.addclass="removesitetag";this.context.removeclass="addsitetag";this.context.indicator.show();this.xhr.send(this.options.sitetag_url,{postId:this.context.id,postIssued:this.context.issued})},promoteSuccess:function(c){this.context.indicator.hide();Message.showMessage(c.message,this.context.message[0]);var b=jQuery("a",this.context.el);if(c.deleted){var d=jQuery("#id_"+c.id+"_"+c.issued);window.setTimeout(function(){d.hide()},3000)}if(c.success){b.removeClass(this.options.classes[this.context.removeclass]);b.addClass(this.options.classes[this.context.addclass]);b.attr("title",this.options.titles[this.context.addclass]);b.attr("alt",this.options.titles[this.context.addclass])}},ajaxFailure:function(){this.context.indicator.hide();Message.showMessage("Network problem has occured.",this.context.message[0])},showWidget:function(){if(this.auth.user&&this.auth.hasLevel("editors")&&typeof this.controls.actionbutton!="undefined"){this.controls.actionbutton.show()}},hideWidget:function(){if(typeof this.controls.actionbutton!="undefined"){this.controls.actionbutton.hide()}}});a.extend(a.ui.PostStatusToggler,{version:"1.0",defaults:{controlClass:"pstcontrol",classes:{promote:"doPromote",demote:"doDemote",sitetag:"doRemoveSiteTag",removesitetag:"deleteButton",addsitetag:"addButton"},prefixes:{postid:"tpid",postissued:"tpissued",postrealm:"tprealm"},titles:{promote:"Promote this post",demote:"Demote this post",addsitetag:"Add this crosspromoted post to this site",removesitetag:"Remove this crosspromoted post from this site"},promote_url:"/?op=changepoststatus",sitetag_url:"/?op=removesitetag"}})})(jQuery);(function(a){a.widget("ui.SearchFormWidget",{initialize:function(){if(this.controls.q[0].value==""){this.controls.q[0].value=this.options.defaultValue;this.controls.q.addClass("noq")}this.xhr=new XHR({klass:"search",success:this.handleAjaxSuccess.bind(this)});this.registerEventHandler(this.element,"click",this.handleClick.bind(this));
this.registerEventHandler(this.controls.form[0],"submit",this.handleSubmit.bind(this));if(this.controls.submit!==undefined){this.registerEventHandler(this.controls.submit[0],"click",this.handleSubmit.bind(this))}this.registerEventHandler(this.controls.q[0],"focus",this.inputFocus.bind(this));this.registerEventHandler(this.controls.q[0],"blur",this.inputBlur.bind(this));this.subscribeForEvent("searchform.searchFinished",this.searchFinished.bind(this));this.subscribeForEvent("searchform.searchFailed",this.searchFailed.bind(this));this.selectFilter("filter","all");this.selectFilter("sort","date");this.searchRunning=false},selectFilter:function(b,c){if(this.searchRunning){return false}jQuery(".searchControl.cn_"+b).removeClass("selected");jQuery(".searchControl.cn_"+b+".cn_"+b+"_"+c).addClass("selected");var d=this.controls.q.val();if(d!=""&&d.toLowerCase()!="search"){this.handleSubmit()}},handleClick:function(c){var b=jQuery(c.target);if(b.hasClass("cn_filter")){this.selectFilter("filter",this.getModifier(b,"filter"));c.preventDefault()}if(b.hasClass("cn_sort")){this.selectFilter("sort",this.getModifier(b,"sort"));c.preventDefault()}},getModifier:function(e,d){var h={filter:"all",sort:"date"};var g=h[d];var c=e.attr("class");if(c!==undefined){c=c.split(" ");var f="cn_"+d+"_";for(var b=0;b<c.length;b++){if(c[b].indexOf(f)==-1){continue}g=c[b].substr(f.length)}}return g},handleSubmit:function(d){Logger.debugLog("SearchFormWidget handleSubmit");this.controls.msg.hide();if(this.controls.q.val()==""){Message.showMessage("Please provide a search phrase.",this.controls.q[0],{stable:false})}else{var c=this.getModifier(jQuery(".searchControl.cn_filter.selected"),"filter");var b=this.getModifier(jQuery(".searchControl.cn_sort.selected"),"sort");this.raiseEvent("navigation.searchInitiated",{q:this.controls.q.val(),filter:c,sort:b});this.controls.q.get(0).disabled=true;this.controls.q.val("Searching...");this.searchRunning=true}if(d!==undefined){d.preventDefault();d.stopPropagation()}return false},handleAjaxSuccess:function(b){},searchFinished:function(b){this.searchRunning=false;this.controls.q.get(0).disabled=false;this.controls.q.val(b.params.q);var c="";if(b.params.results>0){c=b.params.results+" post"+(b.params.results>1?"s":"")+' found for "'+b.params.q+'"'}else{c='Your search "'+b.params.q+'" did not match any posts'}this.controls.msg.html(c);this.controls.msg.show()},searchFailed:function(b){this.searchRunning=false;this.controls.q.get(0).disabled=false;this.controls.q.val("Search");this.controls.msg.html("Search failed, please try again later");this.controls.msg.show()},inputFocus:function(b){Logger.debugLog("SearchFormWidget inputFocus");if(this.controls.q[0].value==this.options.defaultValue){this.controls.q[0].value=""}this.controls.q.removeClass("noq");this.controls.msg.hide()},inputBlur:function(b){Logger.debugLog("SearchFormWidget inputBlur");if(this.controls.q[0].value==""){this.controls.q.addClass("noq");this.controls.q[0].value=this.options.defaultValue}}});a.extend(a.ui.SearchFormWidget,{version:"1.0",defaults:{controlClass:"searchControl",defaultValue:"Search"}})})(jQuery);(function(a){a.widget("ui.ThreadWidget",{controls:{},params:{post_id:null,priority:1,thread_id:null,mode:"all",page:0,append:false,repliesmode:"hide"},threadlist:{},selected_thread:null,thread_visible:true,auth_done:false,post_load_done:false,initialize:function(){this.xhr=new XHR({klass:"thread",type:"POST",beforeSend:this.ajaxRequestHandler.bind(this),error:this.ajaxFailHandler.bind(this),success:this.ajaxSuccessHandler.bind(this)});this.subscribeForEvent("user.auth.",this.eventAuthHandler.bind(this));this.subscribeForEvent("maincontent.postloaded",this.eventPostLoadedHandler.bind(this));this.subscribeForEvent("maincontent.forumloaded",this.eventForumLoadedHandler.bind(this));this.subscribeForEvent("commentform.",this.eventCommentFormHandler.bind(this));this.subscribeForEvent("threads.",this.eventHandler.bind(this))},eventAuthHandler:function(b){if(this.auth_done===false){this.auth_done=true;if(this.post_load_done){this.loadThreadsForPost()}}},eventPostLoadedHandler:function(c){if(c.params.data.action=="post"){this.resetElements();this.setControls();this.parseUserSettings();this.hideThreads();if(c.params.data.disable_comments===true){return false}this.post_load_done=true;this.registerDOMHandlers();this.params.post_id=c.params.data.id;if(window.location.href.indexOf("?comment=")!=-1){var b=(window.location.href.match(/[?&]comment=(?:([0-9]+)\:)?([0-9]+)/));if(b!==null&&b[2]!==undefined){this.selected_thread=b[2];this.params.mode="permalink";this.params.priority=0}}if(this.auth_done===true){this.loadThreadsForPost()}}},eventForumLoadedHandler:function(b){this.params.mode="all";this.raiseEvent("threads.listloaded",{});this.resetElements();this.setControls();this.registerDOMHandlers()},eventCommentFormHandler:function(b){switch(b.name){case"commentform.cancel":if(this.thread_visible===false){this.showThreads()}if(this.params.thread_id&&jQuery(".t_"+this.params.thread_id).length>0){jQuery(".t_"+this.params.thread_id+" .comment:hidden").show()
}break;case"commentform.open":this.setPagerMode("comment");break;case"commentform.close":this.setPagerMode();break}},eventHandler:function(c){var b={};switch(c.name){case"threads.updatelist":if(c.params.force_priority!==undefined&&this.params.priority>parseInt(c.params.force_priority,10)){this.params.priority=parseInt(c.params.force_priority,10)}this.loadThreadList();break;case"threads.listloaded":this.setPagerMode();this.controls.allthreads.hide();this.controls.featuredthreads.hide();if(this.params.mode=="all"){if(this.params.priority==1){this.controls.allthreads.show()}else{this.controls.featuredthreads.show()}}break;case"threads.reloadthread":b.selected_thread=c.params.selected_thread;this.loadThread(b);break;case"threads.threadloaded":LyteBox.prototype.updateLyteboxItems();break;case"threads.showthreads":this.showThreads();break;case"threads.insertcomment":this.appendComment(c.params.comment);break;case"threads.replacecomment":this.replaceComment(c.params.comment);break}},handleClick:function(g){var d=this.getParam("cn",jQuery(g.target));var j=null;switch(d){case"openthread":j=this.getParam("tid",jQuery(g.target));if(!j){g.stopPropagation();g.preventDefault()}this.loadThread({selected_thread:j,jumpto:false});g.stopPropagation();g.preventDefault();break;case"threadexpand":var l=this.params.priority;this.params.priority=0;this.loadThread({jumpto:false});this.params.priority=l;g.stopPropagation();g.preventDefault();break;case"togglereplies":j=this.getParam("tid",jQuery(g.target));var k=this.element.find(".t_"+j);var b=k.find(".cn_togglereplies").eq(0);var h=k.find(".replies").eq(0);var f=k.find("span.repliestoggle").eq(0);if(h.is(":visible")){h.slideUp("fast");f.html("Show");b.addClass("show").removeClass("hide")}else{h.slideDown("fast");f.html("Hide");b.addClass("hide").removeClass("show")}g.stopPropagation();g.preventDefault();break;case"allthreads":this.params.priority=0;this.params.append=false;this.loadThreadList();g.stopPropagation();g.preventDefault();break;case"featuredthreads":this.params.priority=1;this.loadThreadList();g.stopPropagation();g.preventDefault();break;case"jumpto":j=this.getParam("jumpto",jQuery(g.target));jQuery.scrollTo(".cid_"+j,"fast");g.stopPropagation();g.preventDefault();break;case"showfeatured":this.params.mode="featured";this.params.page=0;this.loadThreadList();g.stopPropagation();g.preventDefault();break;case"showall":this.params.mode="all";this.loadThreadList();g.stopPropagation();g.preventDefault();break;case"nextpage":this.params.page++;this.params.append=true;this.loadThreadList();g.stopPropagation();g.preventDefault();break;case"newdiscussion":this.raiseEvent("commentform.open",{clear:true,after:jQuery(".input_box_place")});g.stopPropagation();g.preventDefault();break;case"reply":var m=jQuery(g.target).closest(".comment");var c=this.getParam("cid",m);this.raiseEvent("commentform.open",{after:jQuery(".cid_"+c)});this.raiseEvent("commentform.setreplyto",{replyto:c});g.stopPropagation();g.preventDefault();break}},loadThreadsForPost:function(){try{var b=-1;this.params.page=0;this.params.append=false;this.loadThreadList()}catch(c){}},loadThreadList:function(){try{var c={op:this.options.thread_action,post_id:this.params.post_id,priority:this.params.priority,mode:this.params.mode,page:this.params.page,repliesmode:this.params.repliesmode};if(this.selected_thread!==undefined){c.selected_thread=this.selected_thread;this.selected_thread=null}this.xhr.send("/index.php",c)}catch(b){}},loadThread:function(d){if(d.selected_thread!==undefined||(d.collapse_thread!==undefined&&d.collapse_thread)){this.params.thread_id=d.selected_thread}var c=this.controls.threadlist.find(".t_"+this.params.thread_id);if(d.jumpto===true&&c.length>0){jQuery.scrollTo(c,"fast")}c.addClass("inprogress");var b={op:"commentthread",priority:this.params.priority,thread_id:this.params.thread_id,jumpto:d.jumpto};if(d.selected_comment){b.comment_id=d.selected_comment}if(window.pageType==="site_comments_admin"){b.external_tools=true}this.xhr.send("/index.php",b)},appendComment:function(c){if(c.is_reply===true){var b=jQuery(".cid_"+c.thread_id).closest(".thread");jQuery(".comment:last",b).after(c.content)}else{if(this.params.mode=="featured"){this.controls.threadlist.children().remove();this.controls.threadlist.html(c.content)}else{this.controls.threadlist.prepend(c.content);this.showThreads()}}},replaceComment:function(c){var b=jQuery(".cid_"+c.comment_id);if(b.length>0){b.replaceWith(c.content).show()}},hideThreads:function(){if(this.controls.threadlist!==undefined){this.controls.threadlist.children().hide();this.thread_visible=false}},showThreads:function(){if(this.controls.threadlist!==undefined){this.controls.threadlist.children().show();this.thread_visible=true}},setPagerMode:function(b){if(b===undefined){b=this.params.mode}this.controls.showfeatured.removeClass("selected");this.controls.showall.removeClass("selected");this.controls.newdiscussion.removeClass("selected");switch(b){case"permalink":break;case"all":this.controls.showall.addClass("selected");
break;case"featured":this.controls.showfeatured.addClass("selected");break;case"comment":this.controls.newdiscussion.addClass("selected");break}},ajaxRequestHandler:function(){},ajaxSuccessHandler:function(d){if(d.action=="threadlist"){if(this.params.append===true){this.controls.threadlist.append(d.content)}else{this.controls.threadlist.html(d.content)}this.setControls();if(this.params.mode=="all"&&d.pager===true){this.controls.nextpage.show()}else{this.controls.nextpage.hide()}this.raiseEvent("threads.listloaded",{selected_thread:d.selected_thread,priority:d.priority});if(jQuery(".comment_list_placeholder .thread").length===0){this.raiseEvent("commentform.open",{clear:true,after:jQuery(".input_box_place"),nofocus:true})}var c=window.location.hash.split("^");if((c.length>1&&c[1]=="comments")){jQuery(document).scrollTo("#comments",{duration:500,offset:{top:-20}})}}else{if(d.action=="commentthread"){jQuery(".inprogress").removeClass("inprogress");if(d.moved_comment!==true){var b=jQuery(".t_"+d.thread_id);if(b.length>0){b.html(d.content).slideDown("normal",function(){if(d.jumpto===true){var e=".t_"+d.thread_id;if(d.comment_id>0){e=".comment.cid_"+d.comment_id}jQuery.scrollTo(e,"fast")}})}}this.raiseEvent("threads.threadloaded",{data:d})}}},ajaxFailHandler:function(b){},registerDOMHandlers:function(){this.registerEventHandler(this.element,"click",this.handleClick.bind(this));jQuery(document).bind("keyup",this.keyupHandler.bind(this))},keyupHandler:function(b){},unregisterDOMHandlers:function(){this.tearDownEventHandler(this.element,"click",this.handleClick.bind(this));jQuery(document).unbind("keyup",this.keyupHandler.bind(this))},refreshWidget:function(){this.setControls();this.toggleEditIcons()},parseUserSettings:function(){var b;if(this.auth.authenticated){this.params.priority=(this.auth.user.commentViewMode=="hidden")?0:1}else{this.params.priority=(jQuery.cookie("commentViewMode")=="hidden")?0:1}if(this.auth.authenticated){this.params.mode=(this.auth.user.commentListingMode!="featured")?"all":"featured"}else{this.params.mode="featured";b=jQuery.cookie("commentListingMode");if(b){this.params.mode=(b!="all")?"featured":"all"}}if(this.auth.authenticated){this.params.repliesmode=(this.auth.user.commentRepliesMode!="expanded")?"hide":"show"}else{this.params.repliesmode="show";b=jQuery.cookie("commentRepliesMode");if(b){this.params.repliesmode=(b!="expanded")?"hide":"show"}}}});a.extend(a.ui.ThreadWidget,{version:"1.0",defaults:{action_name:"commentlist",thread_action:"threadlist",onHide:{},onShow:{},onReset:{},controlClass:"tc",externalElement:"#comments"}})})(jQuery);(function(a){a.widget("ui.ThreadAdminWidget",{controls:{},scope:"thread",initialize:function(){this.xhr=new XHR({klass:"threadadmin",type:"POST",beforeSend:this.ajaxRequestHandler.bind(this),error:this.ajaxFailHandler.bind(this),success:this.ajaxSuccessHandler.bind(this)});this.subscribeForEvent("threadadmin.",this.eventHandler.bind(this));this.subscribeForEvent("threads.",this.eventThreadLoadedHandler.bind(this));this.subscribeForEvent("user.auth.",this.eventAuthHandler.bind(this));this.registerEventHandler(this.element,"click",this.handleClick.bind(this))},eventHandler:function(c){switch(c.name){case"threadadmin.messageadd":break;case"threadadmin.setpriority":break;case"threadadmin.priorityset":var d=this.element.find(".cid_"+c.params.comment_id).parents(".thread");var b=this.getParam("t",d);this.handlePriorityChange({comment_id:c.params.comment_id,priority:c.params.priority,thread_root_id:b});break;case"threadadmin.commentapproved":break;case"threadadmin.commentdeleted":this.element.find(".threadwrap.tid_"+c.params.comment_id).fadeOut();break;case"threadadmin.userstatusset":this.handleUserStatusChange({comment_id:c.params.comment_id,commenter_id:c.params.commenter_id,action:c.params.action});break}},eventThreadLoadedHandler:function(b){switch(b.name){case"threads.listloaded":case"threads.threadloaded":case"threads.insertcomment":case"threads.replacecomment":this.tearDownEventHandler(this.element,"click",this.handleClick.bind(this));this.resetElements();this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.setControls();this.showIcons();break}},eventAuthHandler:function(b){this.showIcons()},handleClick:function(d){var c=jQuery(d.target);var h=this.getParam("cn",c);var g=c.closest(".comment");var b=this.getParam("cid",g);var f=this.getParam("aid",g);if(c.hasClass("single")){this.scope="comment"}else{this.scope="thread"}switch(h){case"promote":case"adminpromote":if(g.hasClass("us_pending")){this.changeUserStatus({comment_id:b,commenter_id:f,action:"approve"})}else{this.setPriority({comment_id:b,priority:1,star_user:false})}d.preventDefault();d.stopPropagation();break;case"demote":case"admindemote":this.setPriority({comment_id:b,priority:0,star_user:false});d.preventDefault();d.stopPropagation();break;case"admindelete":this.setState({comment_id:b,commenter_id:f,state:"DELETED"});d.preventDefault();d.stopPropagation();break;case"adminpending":this.changeUserStatus({comment_id:b,commenter_id:f,action:"maybe"});
d.preventDefault();d.stopPropagation();break;case"adminlinks":this.toggleAdminBox({comment_id:b,commenter_id:f});d.preventDefault();d.stopPropagation();break;case"adminpage":this.toggleAdminBox({});window.location="http://commentadmin."+window.location.hostname+"/index.php?op=userlist_search&id="+f+"&siteId="+siteConfig.id;d.preventDefault();d.stopPropagation();break;case"edit":case"adminedit":this.editComment({comment_id:b});d.preventDefault();d.stopPropagation();break;case"approveuser":this.controls.s_ind.show();this.changeUserStatus({comment_id:b,commenter_id:f,action:"approve"});d.preventDefault();d.stopPropagation();break;case"openwarndialog":this.toggleWarnDialog({comment_id:b,commenter_id:f});this.toggleAdminBox({});d.preventDefault();d.stopPropagation();break;case"closewarndialog":this.toggleWarnDialog({});this.toggleAdminBox({});d.preventDefault();d.stopPropagation();break;case"submituserwarn":this.submitWarning({comment_id:b,commenter_id:f});d.stopPropagation();d.preventDefault();break;case"communitypolicy":this.raiseEvent("policypopup.toggle",{});d.stopPropagation();d.preventDefault();break}},ajaxRequestHandler:function(){this.controls.s_ind.show()},ajaxSuccessHandler:function(b){this.controls.s_ind.hide();var c={};switch(b.action){case"promotethread":if(b.success===true){c={comment_id:b.commentId,priority:b.priority};this.raiseEvent("threadadmin.priorityset",c)}break;case"changecommentstatus":if(b.success===true){c={comment_id:b.commentId};if(b.publishStatus=="DELETED"){this.raiseEvent("threadadmin.commentdeleted",c)}}break;case"approveuser":if(b.success===true){c={comment_id:b.commentId,commenter_id:b.commenterId,action:"approve"};this.raiseEvent("threadadmin.userstatusset",c)}break;case"maybeuser":if(b.success===true){c={comment_id:b.commentId,commenter_id:b.commenterId,action:"maybe"};this.raiseEvent("threadadmin.userstatusset",c)}break;case"ajax_warncommenter":this.controls.uw_progress.hide();if(b.success){Message.showMessage("Success",this.controls.uw_message[0],{stable:false,onComplete:function(){this.toggleWarnDialog({});var d='(see <a href="/communitypolicy" class="tac cn_policylink">Community Policy</a>)';var e;e='<a href="/people/'+this.auth.user.username+'/">'+this.auth.user.displayName+"</a> ";if(b.type){switch(b.type){case"warn":e+="warned ";break;case"suspend":e+="suspended ";break;case"ban":e+="banned ";break}e+="this user"}if(b.tagname){if(b.type){e+=" and "}e+='moved this <a href="/'+b.tagname+"/forum?comment="+b.moved_id+'">thread</a> to <a href="/'+b.tagname+'/forum">#'+b.tagname+"</a>";this.element.find(".cid_"+b.root_id+" .ctedit").html("");this.element.find(".cid_"+b.root_id+" .metatext").append('<div class="warnedBy">'+e+" "+d+"</div>");this.element.find(".thread.t_"+b.root_id+" .threadfooter").html("")}else{this.element.find(".cid_"+b.id+" .metatext").append('<div class="warnedBy">'+e+" "+d+"</div>")}}.bind(this,b)})}else{Message.showMessage(b.reason,this.controls.uw_message[0],{stable:false,onComplete:function(){}})}break}},ajaxFailHandler:function(b){this.controls.s_ind.hide()},showIcons:function(){if(this.controls.adminlinks===undefined){return false}if(this.controls.promote){this.controls.promote.css({display:"none"})}if(this.controls.demote){this.controls.demote.css({display:"none"})}if(!this.auth.authenticated){return false}if(this.auth.hasLevel("editors",siteConfig.id)){this.element.find(".p_1 .cn_demote").css({display:""});this.element.find(".p_0 .cn_promote").css({display:""});this.controls.adminlinks.css({display:""})}else{if(this.auth.hasLevel("commentadmins",siteConfig.id)){this.controls.adminlinks.css({display:""});this.element.find(".p_0 .cn_promote").css({display:""})}else{if(this.auth.hasLevel("starcommenters",siteConfig.id)){this.element.find(".p_0 .cn_promote").css({display:""})}}}if(this.auth.hasLevel("commentadmins",siteConfig.id)){this.controls.adminedit.css({display:""})}this.controls.edit.css({display:"none"});this.element.find(".ue.aid_"+this.auth.user.id+" .commentedit").css({display:""})},toggleAdminBox:function(b){if(this.controls.adminbox===undefined){return false}if(b.comment_id===undefined||this.controls.adminbox.is(":visible")){this.controls.adminbox_placetobe.append(this.controls.adminbox).hide()}else{this.element.find(".cid_"+b.comment_id).append(this.controls.adminbox.show())}},setPriority:function(c){var b={op:"ajax_promotethread",comment_id:c.comment_id,priority:c.priority};this.xhr.send(this.options.action_url,b)},handlePriorityChange:function(b){this.controls.s_ind.hide();this.toggleAdminBox({});if(this.scope==="comment"){this.element.find(".cid_"+b.comment_id).removeClass("p_0 p_1").addClass("p_"+b.priority)}else{if(b.thread_root_id){this.raiseEvent("threads.reloadthread",{selected_thread:b.thread_root_id})}}},setState:function(c){var b={op:"changecommentstatus",id:c.comment_id,publishStatus:c.state};this.xhr.send(this.options.action_url,b)},changeUserStatus:function(c){if(c.commenter_id===undefined||c.action===undefined){return false
}var b={op:"changeuserstatus",action:c.action,id:c.commenter_id,siteId:siteConfig.id,commentId:c.comment_id};this.xhr.send(this.options.action_url,b)},handleUserStatusChange:function(b){this.controls.s_ind.hide();this.toggleAdminBox({});switch(b.action){case"approve":this.element.find(".aid_"+b.commenter_id).removeClass("cs_draft us_pending");this.element.find(".cid_"+b.comment_id+" cite").after('<span class="promotedBy">approved by '+this.auth.user.smartName+"</span>");break;case"maybe":this.element.find(".aid_"+b.commenter_id).addClass("cs_draft us_pending");break}},toggleWarnDialog:function(b){if(b.comment_id===undefined&&this.controls.warndialog.is(":visible")){this.controls.warndialog_placetobe.append(this.controls.warndialog).hide();this.controls.uw_moveto.unbind("change");this.controls.uw_state.val("");this.controls.uw_moveto.val("");this.controls.uw_moveto_other.val("").hide()}else{this.element.find(".cid_"+b.comment_id).append(this.controls.warndialog.show());this.controls.uw_moveto.bind("change",function(){if(this.controls.uw_moveto.val()=="other"){this.controls.uw_moveto_other.show()}else{this.controls.uw_moveto_other.hide()}}.bind(this))}},submitWarning:function(e){var b=this.controls.uw_moveto.val();if(b=="other"){b=this.controls.uw_moveto_other.val()}if(b.substring(0,1)=="#"){b=b.substring(1)}var d=this.controls.uw_state.val();if(b||d){var c={op:"ajax_warncommenter",id:e.comment_id,tagname:b,type:d};this.controls.uw_progress.show();this.xhr.send(this.options.action_url,c)}else{this.toggleWarnDialog({})}},editComment:function(b){if(b.comment_id===undefined){return false}this.raiseEvent("commentform.setedit",{comment_id:b.comment_id});this.toggleAdminBox({})}});a.extend(a.ui.ThreadAdminWidget,{version:"1.0",defaults:{action_url:"/index.php",onHide:{},onShow:{},onReset:{},controlClass:"tac",externalElement:"#comments"}})})(jQuery);(function(a){a.widget("ui.WarningCountWidget",{xhr:null,initialize:function(){this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.xhr=new XHR({klass:"warningcount",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)})},handleClick:function(f){var d=this.getParam("cn",jQuery(f.target));switch(d){case"decrease":case"increase":var h=prompt("Add some comment please");if(null!=h){var c=this.getParam("uId",jQuery(f.target));var g={op:"changewarningcount",userId:c,direction:(jQuery(f.target).hasClass("cn_decrease")?-1:1),comment:h};this.xhr.send(this.options.action_url,g);jQuery("#action_indicator_"+c).show()}f.stopPropagation();f.preventDefault();break;case"history_toggle":var c=this.getParam("uId",jQuery(f.target));var b=jQuery("#warning_history_container_"+c)[0];if(b.style.display=="none"){b.style.display="";this.loadHistory(c)}else{b.style.display="none"}f.stopPropagation();f.preventDefault();break}},handleAjaxRequest:function(){},handleAjaxSuccess:function(b){jQuery("#action_indicator_"+b.userId).hide();jQuery(".cn_history_toggle").filter(".uId_"+b.userId)[0].innerHTML=b.warnCount;this.loadHistory(b.userId)},handleAjaxFail:function(){jQuery("#action_indicator_"+data.userId).hide()},loadHistory:function(b){var c={op:"userlist_warning_history",userId:b};jQuery("#warning_history_openable_indicator_"+b).show();jQuery("#warning_history_"+b).hide();jQuery("#warning_history_"+b).load(this.options.action_url,c,function(){jQuery("#warning_history_openable_indicator_"+b).hide();jQuery("#warning_history_"+b).show()})},hideWidget:function(){},showWidget:function(){},resetWidget:function(){}});a.extend(a.ui.WarningCountWidget,{version:"1.0",defaults:{action_url:"/index.php",controlClass:"warningcount_control"}})})(jQuery);(function(a){a.widget("ui.WelcomeBoxWidget",{view_count:0,max_view_count:10,initialize:function(){if(parseInt(jQuery.cookie(this.options.close_cookie_name),10)==1){return true}this.subscribeForEvent("welcomebox.",jQuery.proxy(this.handleEvents,this));this.element.delegate(".cn_close","click",jQuery.proxy(this.closeBox,this));this.element.delegate(".cn_classic_link","click",jQuery.proxy(this.switchToClassic,this));this.view_count=parseInt(jQuery.cookie(this.options.view_cookie_name),10);if(!this.view_count){this.view_count=0}this.showWidget()},handleEvents:function(b){if(b.name=="welcomebox.incrementview"){this.incrementPageViewCount()}},closeBox:function(b){jQuery.cookie(this.options.close_cookie_name,"1",{path:"/",expires:3650});this.hideWidget();return false},switchToClassic:function(b){this.closeBox();this.raiseEvent("navigation.gotoclassic",{});return false},showWidget:function(){if(this.view_count<this.max_view_count){this.element.show();var b=GawkerClientside.widgets.rightbar;if(typeof b!=="undefined"){b=b[0];b.de.rightbar_scroller.height(b.de.rightcontainer.height()-b.de.rightbar_scroller.offset().top)}}},hideWidget:function(){this.element.hide();var b=GawkerClientside.widgets.rightbar;if(typeof b!=="undefined"){b=b[0];b.de.rightbar_scroller.height(b.de.rightcontainer.height()-b.de.rightbar_scroller.offset().top)
}},incrementPageViewCount:function(){if(this.view_count<=this.max_view_count){this.view_count++;jQuery.cookie(this.options.view_cookie_name,this.view_count,{path:"/",expires:3650})}else{this.closeBox()}}});a.extend(a.ui.WelcomeBoxWidget,{version:"1.0",defaults:{view_cookie_name:"welcome-box_count",close_cookie_name:"welcome-box_shown",controlClass:"wbc",externalElement:".wbc_external"}})})(jQuery);(function(a){a.widget("ui.AdUnit",{xhr:null,default_sizes:["160x600","300x600","640x360","300x250","1x2","2x1"],refreshable_variants:["300x250_default"],hyperion_url:"",dart_url:"",status:[],ad_conditions:{"300x250_default":function(b){return(window.pageType==="frontpage"||window.pageType==="classic_frontpage"||window.pageType==="splash_post")}},special_togglers:{"82x50_default":{hide:{right_on:function(b){}},show:{right_on:function(b){jQuery(b).closest("li").hover(function(){var d=jQuery(this).height();jQuery(this).height(d+"px");jQuery(".tag.toggleable",jQuery(this)).eq(0).hide();jQuery(".tag.toggleable",jQuery(this)).eq(1).show()},function(){jQuery(".tag.toggleable",jQuery(this)).eq(0).show();jQuery(".tag.toggleable",jQuery(this)).eq(1).hide()}).css({"min-height":"60px"});var c=jQuery(b+" img").attr("alt");if(c!=="Click here to find out more!"){jQuery(".broughtby",jQuery(b).closest(".text")).html(c)}}}},"160x600_default":{hide:{on_ready:function(b){jQuery("#skyscraper").hide();jQuery("#skySpacer").hide()}},show:{on_ready:function(b){jQuery("#skyscraper").show();jQuery("#skySpacer").show()}}},"300x250_default":{hide:{right_on:function(b){if(false===(window.adRobot.marquee_running||window.adRobot.interstitial_running)){jQuery("#tomorrowsnews").hide()}}},show:{right_on:function(b){jQuery("#tomorrowsnews").hide()}}},"300x250_maincontent":{hide:{right_on:function(b){}},show:{right_on:function(b){}}},"300x600_default":{show:{right_on:function(b){var e=jQuery("iframe",jQuery(b));var f=e.contents().find("embed, img");for(var d=0,c=f.length;d<c;d++){if(parseInt(f.eq(d).attr("width"),10)===160){e.attr({width:160});return true}}}},hide:{right_on:function(b){}}},"660x300_default":{show:{right_on:function(b){window.adRobot.interstitial_running=true;jQuery(".post-body .ad_300x600, .ad.panorama").hide().empty();jQuery.cookie("interstitial_shown","true",{expires:(24*60*60),path:"/"});jQuery("#interstitial_bottom").show()}},hide:{right_on:function(b){window.adRobot.interstitial_running=false;jQuery("#interstitial_bottom").hide()}}},"640x360_default":{show:{right_on:function(b){}},hide:{right_on:function(b){}}}},initialize:function(){this.xhr=new XHR({klass:"adunit",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this),timeout:5000});this.options.original_size=this.options.size;this.options.size_variant=this.options.size+"_"+this.options.variant;this.options.target_selector="#ad_container_"+this.options.random;this.addAdInfo("ad_random",this.options.random);this.addAdInfo("size",this.options.original_size);if(this.default_sizes.indexOf(this.options.size)>-1){this.options.size="defaults"}if(this.refreshable_variants.indexOf(this.options.size_variant)>-1){this.subscribeForEvent("maincontent.frontpageloaded",this.mainContentLoaded.bind(this));this.subscribeForEvent("maincontent.classicfrontpageloaded",this.mainContentLoaded.bind(this));this.subscribeForEvent("maincontent.postloaded",this.mainContentLoaded.bind(this));this.subscribeForEvent("maincontent.forumloaded",this.mainContentLoaded.bind(this))}if(this.options.size_variant==="660x300_default"){this.subscribeForEvent("ad.interstitial.",this.interstitialEventHandler.bind(this))}if(this.options.size_variant==="300x250_default"){jQuery(document).bind("ad.marquee.finished",jQuery.proxy(this.marqueeEventHandler,this))}this.requestAd()},requestAd:function(){this.hyperion_url="";this.dart_url="";var g=false;var d=false;if(this.options.forced_zone!==undefined){g=this.options.forced_zone}var f=window.location.href.match(/\?(.+)$/);if(f!==null){var c=window.gawker_parseQueryString(f[1]);if(c.adzone!==undefined){g=c.adzone}else{if(c.no_ads_for_me_rosebud!==undefined){if(c.no_ads_for_me_rosebud=="true"){d=true;jQuery.cookie("no_ads_for_me_rosebud",1,{expires:0.25,path:"/"})}else{jQuery.cookie("no_ads_for_me_rosebud",null)}}}}if(g!==false&&this.options.request_ad===true){this.forgeFakeResponse({success:this.adConditionsApply(),ad_zone:g})}else{if(d===true||jQuery.cookie("no_ads_for_me_rosebud")==1){this.forgeFakeResponse({success:false})}else{var h=["site_id="+this.options.site_id,"size="+this.options.size,"random="+this.options.random];if(window.pageType==="splash_post"){h.push("page_type=frontpage")}else{if(window.pageType==="tagpage"){h.push("page_type=tag")}else{h.push("page_type="+window.pageType)}}if(this.options.tags&&this.options.tags.length>0){for(var e=0,b=this.options.tags.length;e<b;e++){h.push("tags[]="+this.options.tags[e])}}if(document.referrer!==""){h.push("referer="+encodeURIComponent(document.referrer))}if(this.options.ged_zone!==undefined){h.push("ged_zone="+this.options.ged_zone)
}if(this.options.issued!==undefined){h.push("issued="+this.options.issued)}h.push("jsonp=?");this.hyperion_url="http://"+this.options.adserver_host+"/ad/"+this.options.original_size+"?"+h.join("&");this.addAdInfo("hyperion_url",this.hyperion_url);if(this.adConditionsApply()&&this.options.request_ad===true){this.setStatus("hyperion_request_sent",true);this.xhr.getJSON(this.hyperion_url)}else{this.setStatus("skipping_request",true)}}}},adConditionsApply:function(){if(this.ad_conditions[this.options.size_variant]){return this.ad_conditions[this.options.size_variant](this.options.target_selector)}return true},updateOptions:function(b){for(var c in b){if(b.hasOwnProperty(c)){if(b[c]!==null){this.options[c]=b[c]}else{delete this.options[c]}}}},refreshAd:function(){if(this.refreshable_variants.indexOf(this.options.size_variant)>-1){this.setStatus("refreshing");this.requestAd()}},handleAjaxRequest:function(){},handleAjaxSuccess:function(b){this.setStatus("hyperion_request_success");this.renderAd(b)},handleAjaxFail:function(){this.setStatus("hyperion_request_fail");if(this.options.fallback_zone){return this.forgeFakeResponse({success:true,ad_zone:this.options.fallback_zone})}else{return this.forgeFakeResponse({success:false})}},forgeFakeResponse:function(c){var b={action:"ad_select",success:c.success,random:this.options.random};if(c.ad_zone!==undefined){b.type="zone";b.params={ad_zone:c.ad_zone}}return this.handleAjaxSuccess(b)},renderAd:function(b){if(b.action==="ad_select"&&b.success===true){Logger.debugLog("rendering "+this.options.original_size+"@"+this.options.target_selector);if(b.type==="zone"){this.renderDartZone(b)}}else{jQuery(this.options.target_selector).html("");this.hideEmpty()}},renderDartZone:function(e){var c=["ptile="+window.adRobot.ptile++,"sz="+this.options.original_size,"ord="+(this.options.random+window.adRobot.ptile)];var f=0,d=0;var g=[];for(f=0,d=this.options.keywords.length;f<d;f++){g.push(this.options.keywords[f])}if(this.auth.hasLevel("commenters")){g.push("commenter=yes");if(this.auth.hasLevel("starcommenters")){g.push("star=yes")}}if(e.keywords){for(f=0,d=e.keywords.length;f<d;f++){if(c.indexOf(e.keywords[f])<0){g.push(e.keywords[f])}}}this.addAdInfo("keywords",g.join(", "));for(f=0,d=g.length;f<d;f++){c.push(g[f])}var m=this.options.site+"/"+e.params.ad_zone;var b="http://ad.doubleclick.net/adj/"+m+";"+c.join(";")+"?";this.addAdInfo("zone",m);this.dart_url=b;this.addAdInfo("dart_url",this.dart_url);var k=this;var j=function(){k.hideEmpty()};if(this.options.mode=="iframe"){this.setStatus("iframe_render_starting");jQuery("#ad_iframe_"+this.options.random).unbind("load").bind("load",j);jQuery("#ad_iframe_"+this.options.random).get(0).contentWindow.location.replace("/static/ad_iframe.php?script_url="+encodeURIComponent(b)+"&rand="+k.options.random+"&nocache=true");if(jQuery.browser.msie){this.waitForIframe("ad_iframe_"+this.options.random,1,j)}this.setStatus("iframe_render_started")}else{var h=['<script type="text/javascript" src="'+b+'"><\/script>'];h=h.join("\n");this.setStatus("div_render_starting");this.element.html(jQuery.writeCapture.sanitize(h,j));this.setStatus("div_render_started")}},waitForIframe:function(f,d,g){var c=this;var b=document.getElementById(f);var e=b&&b.contentWindow&&b.contentWindow.document&&b.contentWindow.document.ad_is_ready;if(e===undefined&&d++<20){window.setTimeout(function(){c.waitForIframe(f,d,g)},250)}else{window.setTimeout(function(){g()},500)}},hideEmpty:function(){this.setStatus("hide_empty_called");if(this.adIsEmpty()===true){this.setStatus("ad_was_empty");Logger.debugLog(this.options.original_size+" was empty");this.hideAd(this.options.target_selector,this.options.size_variant);if(this.options.original_size=="300x600"){this.element.find("iframe").attr({width:300,height:250}).contents().empty();this.options.original_size="300x250";this.requestAd()}}else{this.setStatus("ad_was_there");this.showAd(this.options.target_selector,this.options.size_variant)}},adIsEmpty:function(){var d=this.element[0],c="",f=[],b=false;if(jQuery("iframe",d).length>0){var e=jQuery("iframe",d).contents().find("body");c=e.html();f=e.find("[src]")}else{c=d.innerHTML;f=jQuery("[src]",d)}if(jQuery.trim(c).length===0){b=true}else{f.each(function(h,g){if(g.src&&g.src.match(/817-grey.gif/)){b=true}})}this.addAdInfo("empty_ad",b);return b},showAd:function(b,c){if(c!=="300x250_default"||!(window.adRobot.marquee_running||window.adRobot.interstitial_running)){if(c==="660x300_default"){if(jQuery.browser.safari){jQuery(b).fadeIn("slow")}else{jQuery(b).slideDown("slow")}}else{jQuery(b).show()}this.callSpecialTogglers(b,c,"show")}},hideAd:function(b,c){if(c==="660x300_default"){jQuery(b).slideUp("slow")}else{jQuery(b).hide()}this.callSpecialTogglers(b,c,"hide")},callSpecialTogglers:function(b,d,e){if(this.special_togglers[d]&&this.special_togglers[d][e]){var c=this.special_togglers[d][e];if(c.on_ready){jQuery().ready(function(){c.on_ready(b)})}if(c.right_on){c.right_on(b)}}},setStatus:function(f,e){this.addAdInfo("status",f);
if(e===true){this.status=[]}var c=new Date();var d=c.getTime();var b={status_text:f,timestamp:d};this.status.push(b)},mainContentLoaded:function(c){if(window.pageType==="frontpage"||window.pageType==="classic_frontpage"||window.pageType==="splash_post"){this.updateOptions({request_ad:true});this.refreshAd()}else{var b=".ad_300x250 .ad_container.default";this.hideAd(b,"300x250_default");jQuery(b).removeData("ad_info").prev("div .ad_info").remove()}},marqueeEventHandler:function(b){switch(b.namespace){case"init.marquee":jQuery(this.options.target_selector).hide();jQuery("#aboveheadlinevideo").css({height:"385px"});jQuery("#aboveheadlinevideo object").hide();break;case"finished.marquee":if(window.pageType==="frontpage"||window.pageType==="classic_frontpage"||window.pageType==="splash_post"){if(false===this.adIsEmpty()){this.showAd(this.options.target_selector,"300x250_default")}jQuery("#tomorrowsnews").hide()}break}},interstitialEventHandler:function(b){switch(b.name){case"ad.interstitial.init":break;case"ad.interstitial.started":if(this.browser=="ie"){jQuery("#interstitial_countdown_container").css("opacity",1);jQuery("#interstitial_bottom_info").css("opacity",1);jQuery("#bannercontainer").css("opacity",1)}else{jQuery("#interstitial_countdown_container").animate({opacity:1},500);jQuery("#interstitial_bottom_info").animate({opacity:1},500);jQuery("#bannercontainer").animate({opacity:1},500)}break;case"ad.interstitial.finished":this.hideAd(".ad_interstitial","660x300_default");break}},addAdInfo:function(b,d){var c=this.element.data("ad_info");if(c===undefined){c={}}c[b]=d;this.element.data("ad_info",c)}});a.extend(a.ui.AdUnit,{version:"1.0",defaults:{adserver_host:"localhost:8800",controlClass:"ad_control"}})})(jQuery);(function(a){a.widget("ui.EditorControlsWidget",{adminlinks_open:false,initialize:function(){this.xhr=new XHR({klass:"editorcontrols",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});var b={};var c=false;if(this.controls.starinvite_form){b.starinvite={el:this.controls.starinvite_dialog,focus:this.controls.starinvite_email};this.starinvite_validator=new Validator(jQuery.extend({},{scope:this.controls.starinvite_form}));this.registerEventHandler(this.controls.starinvite_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.starinvite_form,"submit",this.handleStarInviteSubmit.bind(this));this.controls.starinvite_form[0].reset();c=true}if(this.controls.tagheader_form){b.tagheader={el:this.controls.tagheader_dialog,focus:this.controls.tagheader_entry};this.tagheader_validator=new Validator(jQuery.extend({},{scope:this.controls.tagheader_form}));this.registerEventHandler(this.controls.tagheader_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.tagheader_form,"submit",this.handleTagheaderSubmit.bind(this));this.controls.tagheader_form[0].reset();c=true}if(c){this.commondialogs.initDialogs({overlay:this.controls.overlay,panels:b,group:this.options.dialoggroup?this.options.dialoggroup:false})}this.bindDOMHandlers();this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this));this.subscribeForEvent("maincontent.postloaded",this.loadedEventHandler.bind(this))},bindDOMHandlers:function(){this.registerEventHandler(this.element,"click",this.handleClick.bind(this))},authEventHandler:function(b){switch(b.name){case"user.auth.success":this.setupControls();break;case"user.auth.failure":if(this.controls.for_editors){this.controls.for_editors.hide()}if(this.controls.starinvite_link){this.controls.starinvite_link.hide()}if(this.controls.tagheader_link){this.controls.tagheader_link.hide()}this.element.eq(0).hide();break}},setupControls:function(){var f=false;if(this.controls.for_editors){if(this.auth.hasLevel("authors","highest")){this.controls.for_editors.show()}else{this.controls.for_editors.hide()}}if(this.controls.slurp_toggle){if(this.setupSlurpForm()){this.controls.slurp_toggle.show()}else{this.controls.slurp_toggle.hide()}}if(this.controls.starinvite_link){if(this.auth.hasLevel("commentadmins")){var e=this.controls.starinvite_email[0].className.split("valid_limit_comma-").pop().split(" ")[0];this.controls.starinvite_email.removeClass("valid_limit_comma-"+e);this.starinvite_validator.setupInfield(this.controls.starinvite_email[0]);this.controls.starinvite_left.html("");this.controls.starinvite_link.show()}else{if(this.auth.hasLevel("commenters")){var c=this.getParam("limitnormal",this.controls.starinvite_link);var h=parseInt(this.getParam("epoch",this.controls.starinvite_link),10);var b=parseInt(this.getParam("timeframe",this.controls.starinvite_link),10);if(this.auth.hasLevel("starcommenters")){c=this.getParam("limitstar",this.controls.starinvite_link)}c=parseInt(c,10);var g=c?c:10;if(window.myUserLocation&&window.myUserLocation["t"]&&this.auth.user.lastInviteTime){var d=parseInt(this.auth.user.lastInviteTime,10);if((myUserLocation.t-d)<(b-((d-h)%b))){g=c-parseInt(this.auth.user.recentInviteCount,10)
}}var e=this.controls.starinvite_email[0].className.split("valid_limit_comma-").pop().split(" ")[0];this.controls.starinvite_email.removeClass("valid_limit_comma-"+e).addClass("valid_limit_comma-"+g);this.starinvite_validator.setupInfield(this.controls.starinvite_email[0]);this.controls.starinvite_left.html("("+g+" left)");if(g>0){this.controls.starinvite_link.show()}}else{this.controls.starinvite_link.hide()}}}if(this.controls.tagheader_link){if(this.controls.tagheader_enabled.html()=="true"){if(this.auth.hasLevel("editors")){this.controls.tagheader_entry.val(this.controls.tagheader_entry_orig.html().trim());this.controls.tagheader_postid.val(this.controls.tagheader_postid_orig.html());this.controls.tagheader_id.val(this.controls.tagheader_postid_orig.html());this.controls.tagheader_tags.val(this.controls.tagheader_tags_orig.html());this.controls.tagheader_link.show()}}}if(this.adminlinks_open&&jQuery("#debug_pane").css("display")=="block"){jQuery("#editorControlsWidget").toggle();jQuery(".cn_debug_info").html("Hide Debug Info")}else{this.adminlinks_open=false}if(f){this.element.eq(0).show()}else{this.element.eq(0).hide()}},loadedEventHandler:function(b){this.resetElements();this.setControls();this.bindDOMHandlers();this.setupControls()},handleClick:function(c){var b=this.getParam("cn",c.target);switch(b){case"slurp_toggle":case"slurp_cancel":if(this.option("disabled")==false){this.toggleSlurpDialog()}break;case"slurp_button":if(this.controls.slurp_select[0].value==-1){Message.showMessage("Please select a site",this.controls.slurp_message[0],{})}else{this.controls.slurp_indicator.show();this.xhr.send("/index.php",this.controls.slurp_form.serialize())}break;case"draft_link":if(confirm("Delete post?")){var d=[];d.push("op=changepoststatus");d.push("v2=true");d.push("id="+this.getParam("postId",this.controls.draft_link));d.push("publishStatus=DRAFT");d.push("realm=");this.xhr.send("/index.php",d.join("&"))}break;case"starinvite_link":this.controls.starinvite_postid.val(this.getParam("postId",c.target));case"starinvite_cancel":if(this.auth.hasLevel("commentadmins")||this.auth.hasLevel("commenters")){if(this.controls.starinvite_copy){this.controls.starinvite_copy.html("To create invites, paste in a list of comma-separated email addresses, and then click send invites.")}}else{if(this.auth.hasLevel("starcommenters")){if(this.controls.starinvite_copy){this.controls.starinvite_copy.html("To create invites for new users, paste in a list of comma-separated email addresses, and then click send invites.")}}}this.commondialogs.toggleDialog({which:"starinvite"});break;case"tagheader_link":case"tagheader_cancel":if(this.auth.hasLevel("editors")){this.commondialogs.toggleDialog({which:"tagheader"})}break;case"toggleadminlinks":jQuery("#editorControlsWidget").toggle();this.adminlinks_open=!this.adminlinks_open;break;default:return true;break}c.stopPropagation();c.preventDefault();return false},handleKeyUp:function(b){switch(b.keyCode){case jQuery.ui.keyCode.ESCAPE:this.commondialogs.toggleDialog();break}},handleStarInviteSubmit:function(b){b.stopPropagation();b.preventDefault();this.starinvite_validator.hideErrors();if(this.starinvite_validator.validate()){this.mystate="starinvite_sent";this.xhr.send(this.options.starinvite_action_url,this.controls.starinvite_form.serialize())}else{this.mystate="starinvite_dialog_visible";if(this.options.show_validation_errors){this.starinvite_validator.showErrors()}}},handleTagheaderSubmit:function(b){b.stopPropagation();b.preventDefault();this.tagheader_validator.hideErrors();if(this.tagheader_validator.validate()){this.mystate="tagheader_sent";this.xhr.send(this.options.tagheader_action_url,this.controls.tagheader_form.serialize())}else{this.mystate="tagheader_dialog_visible";if(this.options.show_validation_errors){this.tagheader_validator.showErrors()}}},handleAjaxRequest:function(){switch(this.mystate){case"slurp_sent":this.disableInputs("slurp");break;case"starinvite_sent":this.disableInputs("starinvite");this.controls.starinvite_indicator.show();break;case"tagheader_sent":this.disableInputs("tagheader");this.controls.tagheader_indicator.show();break}},handleAjaxSuccess:function(d){if(d.postSave){d={action:"postSave",success:d.postSave.success,postid:d.postSave.postId}}switch(d.action){case"addsitetag":if(d.success){this.controls.slurp_indicator.hide();Message.showMessage(d.message,this.controls.slurp_message[0],{onComplete:function(){this.toggleSlurpDialog();this.enable()}.bind(this)})}else{this.controls.slurp_indicator.hide();Message.showMessage(d.message,this.controls.slurp_message[0]);this.enableInputs("slurp")}break;case"changeposttag_add":if(d.success){this.controls.top_link.hide();this.controls.untop_link.show()}break;case"changeposttag_remove":if(d.success){this.controls.top_link.show();this.controls.untop_link.hide()}break;case"starinvite":this.enableInputs("starinvite");this.controls.starinvite_indicator.hide();if(d.success){if(!this.auth.hasLevel("commentadmins")){var c=d.left?d.left:0;
var b=this.controls.starinvite_email[0].className.split("valid_limit_comma-").pop().split(" ")[0];this.controls.starinvite_email.removeClass("valid_limit_comma-"+b).addClass("valid_limit_comma-"+c);this.starinvite_validator.setupInfield(this.controls.starinvite_email[0]);this.controls.starinvite_left.html("("+c+" left)");this.auth.resetRevision();if(c==0){this.controls.starinvite_link.hide()}Message.showMessage((d.message?d.message:"Invitation(s) sent. "+c+" left."),this.controls.starinvitemessage[0])}else{Message.showMessage((d.message?d.message:"Invitation(s) sent."),this.controls.starinvitemessage[0])}this.fireEvent("onInviteSuccess",this,true);this.syncEffect({el:this.commondialogs,fn:"toggleDialog",params:{which:"starinvite",sync_this:this.syncEffect.bind(this)}});this.controls.starinvite_email.val("");this.mystate="idle"}else{Message.showMessage((d.message?d.message:"Invitation failed."),this.controls.starinvitemessage[0]);this.mystate="starinvite_dialog_visible"}break;case"postSave":this.enableInputs("tagheader");this.controls.tagheader_indicator.hide();if(d.success){Message.showMessage((d.message?d.message:"Tagheader saved."),this.controls.tagheadermessage[0]);this.fireEvent("onTagheaderSuccess",this,true);this.syncEffect({el:this.commondialogs,fn:"toggleDialog",params:{which:"tagheader",sync_this:this.syncEffect.bind(this)}});this.controls.tagheader_entry_orig.html(this.controls.tagheader_entry.val());this.mystate="idle"}else{Message.showMessage((d.message?d.message:"Tagheader save failed."),this.controls.tagheadermessage[0]);this.mystate="tagheader_dialog_visible"}break}},handleAjaxFail:function(){switch(this.mystate){case"starinvite_sent":this.enableInputs("starinvite");this.mystate="starinvite_dialog_visible";break;case"tagheader_sent":this.enableInputs("tagheader");this.mystate="tagheader_dialog_visible";break}},disableInputs:function(b){switch(b){case"slurp":this.disable();jQuery("select, button",this.controls.slurp_form).each(function(d,c){c.disabled=true});break;case"starinvite":this.controls.starinvite_email[0].disabled=true;this.controls.starinvite_submit[0].disabled=true;this.controls.starinvite_cancel[0].disabled=true;break;case"tagheader":this.controls.tagheader_entry[0].disabled=true;this.controls.tagheader_submit[0].disabled=true;this.controls.tagheader_cancel[0].disabled=true;break}},enableInputs:function(b){switch(b){case"slurp":this.enable();jQuery("select, button",this.controls.slurp_form).each(function(d,c){c.disabled=false});break;case"starinvite":this.controls.starinvite_email[0].disabled=false;this.controls.starinvite_submit[0].disabled=false;this.controls.starinvite_cancel[0].disabled=false;break;case"tagheader":this.controls.tagheader_entry[0].disabled=false;this.controls.tagheader_submit[0].disabled=false;this.controls.tagheader_cancel[0].disabled=false;break}},toggleSlurpDialog:function(){if(this.controls.slurp_dialog[0].style.display=="none"){this.enableInputs("slurp");this.controls.slurp_form[0].reset()}this.controls.slurp_dialog.slideToggle()},setupSlurpForm:function(){var c=this.controls.slurp_select[0].options;var b=c.length-1;for(var d=b;d>0;d--){if(this.auth.site.siteId==c[d].value||!this.auth.hasLevel("authors",c[d].value)){c[d]=null}}if(c.length<3){c[0]=null}return(c.length>0)}});a.extend(a.ui.EditorControlsWidget,{version:"1.0",defaults:{controlClass:"editor_control",externalElement:".presence_control_external, .editorControlsWidget_external, #presence_external_templates",show_validation_errors:true,starinvite_action_url:"/?op=sendinvite",tagheader_action_url:"/?op=admin_savepost",onInviteSuccess:function(b){window.setTimeout(function(){b.syncEffect()},1000);return"will_sync"},onTagheaderSuccess:function(b){window.setTimeout(function(){b.syncEffect()},1000);return"will_sync"}}})})(jQuery);(function(a){a.widget("ui.GalleryWidget",{initialize:function(){this.gallery=this.options.galleryData;if(this.gallery===undefined){this.gallery={}}if(this.gallery.images===undefined){this.gallery.images=[]}var c=this;jQuery("#galleryNextImage").click(function(d){c.loadItem("next");d.preventDefault();d.stopPropagation()});jQuery("#galleryPrevImage").click(function(d){c.loadItem("prev");d.preventDefault();d.stopPropagation()});jQuery("#thumbs .thumb").click(function(d){var f=parseInt(jQuery(d.target).data("pos"),10);c.loadItem(f);d.preventDefault();d.stopPropagation()});jQuery("#thumbPagerPrev").click(function(d){c.pageThumbs(false);d.preventDefault();d.stopPropagation()});jQuery("#thumbPagerNext").click(function(d){c.pageThumbs(true);d.preventDefault();d.stopPropagation()});this.selImage=this.options.selImgPos;this.curContainer=1;this.thumbPages=[0];this.thumbs=jQuery("#thumbList img");var b=0},loadItem:function(h){if(h=="next"){if(this.selImage<this.gallery.images.length-1){h=this.selImage+1}else{h=0}}else{if(h=="prev"){if(this.selImage>0){h=this.selImage-1}else{h=this.gallery.images.length-1}}}var e=3-this.curContainer;var g=this.gallery.images[h];if(g==undefined){return}jQuery("#galleryOverlay").show();
var d=function(l,k,j){return function(){l.thumbs.removeClass("current");l.thumbs.eq(j).addClass("current");var n=jQuery("#galleryItem"+k+" img");jQuery("#galleryItem"+k).show();jQuery("#captionHolder"+k).show();jQuery("#captionHolder"+l.curContainer).hide();jQuery("#gallerypost_container").removeClass("selImage_"+l.selImage).addClass("selImage_"+j);if(n.length>0){var m=n.width()/n.height();var q=16/9;if(m>=q){n.width(640)}if(m<=q){n.height(360)}}jQuery("#galleryItem"+(3-k)).hide().html('<span id="galleryPlaceholder'+(3-k)+'"></span>');l.curContainer=k;l.selImage=j;var o=l.thumbs.last();if(o.position().left+o.width()>jQuery("#thumbWindow").width()){var p=0;if(j>2){p=l.thumbs.eq(j-2).position().left-5}jQuery("#thumbList").css("left",-1*p)}jQuery("#galleryOverlay").hide()}};var c=d(this,e,h);jQuery("#captionHolder"+e).html(g.caption);if(g.videoData!==false){g.videoData.customHandler=c;g.videoData.width=640;g.videoData.height=360;VideoHandler.dumpObject(g.videoData,"galleryItem"+e);jQuery("#galleryExpand").attr("href","#").css("opacity",0);this.reloadAds()}else{var b=jQuery(document.createElement("img"));var f=this;b.click(function(j){f.loadItem("next");j.preventDefault();j.stopPropagation()});b.load(c);b.attr("src",g.bigimage);this.reloadAds();jQuery("#galleryPlaceholder"+e).replaceWith(b);if(g.bigimage1600!==undefined){jQuery("#galleryExpand").attr("href",g.bigimage1600).css("opacity",1)}else{jQuery("#galleryExpand").attr("href","#").css("opacity",0)}}trackers.reload({post_id:window.postId})},pageThumbs:function(b){var h=this.thumbs.last();var j=h.position().left+h.width();var e=595;if(j>e){var g=-1*parseInt(jQuery("#thumbList").css("left"),10);var d=0;if(b!==true){b=false}if(b&&j-g<e){return}if(!b&&g==0){return}var c=g+((b?1:-1)*e);if(c<0){c=0}if(c>j-e+7){c=j-e+7}var f=-1*c+"px";jQuery("#thumbList").css("left",f)}},reloadAds:function(){if(siteConfig.canonicalHost.indexOf("fleshbot")!=-1){var b=[".ad.footer_640x90 iframe",".ad.panorama iframe"];jQuery(b).each(function(c,d){var f=jQuery(d).attr("src");if(f){if(f.indexOf("&rnd=")==-1){f+="&rnd="}f=f.split("&rnd=")[0]+"&rnd="+Math.random();jQuery(d).attr("src",f)}})}}});a.extend(a.ui.GalleryWidget,{version:"1.0",defaults:{controlClass:"galcn",externalElement:".galcn_external"}})})(jQuery);(function(a){a.widget("ui.HybridLink",{xhr:null,initialize:function(){this.xhr=new XHR({klass:"hybridlink",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.showWidget()},handleClick:function(c){var b=this.getParam("cn",jQuery(c.target));switch(b){case"link":var d={op:"hybrid_add_tag",tagName:this.getParam("tag",jQuery(c.target))};this.xhr.send("/",d);c.stopPropagation();c.preventDefault();break}},handleAjaxRequest:function(){this.controls.indicator.show()},handleAjaxSuccess:function(b){Message.showMessage(b.message,this.controls.message[0]);document.location=b.url},handleAjaxFail:function(){this.controls.indicator.hide();Message.showMessage("Request failed",this.controls.message[0])}});a.extend(a.ui.HybridLink,{version:"1.0",defaults:{controlClass:"hybrid_control"}})})(jQuery);(function(a){a.widget("ui.MiniRightbarWidget",{initialize:function(){jQuery("#load_more").click(jQuery.proxy(function(b){b.stopPropagation();b.preventDefault();this.gotoPage({direction:"next"})},this));jQuery("#load_previous").click(jQuery.proxy(function(b){b.stopPropagation();b.preventDefault();this.gotoPage({direction:"prev"})},this));jQuery("#switch_popular").click(jQuery.proxy(function(b){b.stopPropagation();b.preventDefault();this.loadPopular()},this));jQuery("#switch_latest").click(jQuery.proxy(function(b){b.stopPropagation();b.preventDefault();this.loadLatest()},this));if(jQuery("#post_list .latestpost").length){jQuery("#load_previous").hide()}if(jQuery("#post_list .oldestpost").length){jQuery("#load_more").hide()}if(window.sponsored!==undefined){window.sponsored.displaySponsoredPost();window.sponsored.displayOldSponsoredPosts()}},gotoPage:function(e){var c,d,b;if(e.direction=="prev"){c=jQuery("#post_list li:first-child").get(0).id.substring(7)}else{if(e.direction=="next"){c=jQuery("#post_list li:last-child").get(0).id.substring(7)}}d=this.getParam("tag",jQuery("#post_list"));if(typeof d!="undefined"){b="&tagName="+d}else{b=""}jQuery.get("/?op=ajaxlight_rightbar&direction="+e.direction+"&refId="+c+b,jQuery.proxy(function(f){this.insertContent(f,e.direction)},this))},insertContent:function(d,e){var c,b;if(e=="prev"){c=".lastestpost";b="#load_previous";jQuery("#post_list").prepend(d.content)}else{c=".oldestpost";b="#load_more";jQuery("#post_list").append(d.content)}if(jQuery("#post_list "+c).length){jQuery(b).hide()}if(window.sponsored!==undefined){window.sponsored.displayOldSponsoredPosts()}},loadPopular:function(){var b=jQuery("#post_list");b.css({opacity:0.4});jQuery("#post_list_cache").html(b.html());jQuery.get("/?op=ajaxlight_rightbar&mode=popular",function(c){jQuery("#navigation .current").removeClass("current");
jQuery("#navigation #switch_popular").addClass("current");jQuery("#rightbar .stories").hide();if(c.content){b.html(c.content)}b.css({opacity:1})})},loadLatest:function(){var b=jQuery("#post_list");if(jQuery("#post_list_cache li").eq(0).html().length){jQuery("#navigation .current").removeClass("current");jQuery("#navigation #switch_latest").addClass("current");jQuery("#rightbar .stories").show();b.html(jQuery("#post_list_cache").html())}else{b.css({opacity:0.4});jQuery.get("/?op=ajaxlight_rightbar&direction=latest&mode=current&"+(window.postId?"&refId="+window.postId:""),function(c){jQuery("#navigation .current").removeClass("current");jQuery("#navigation #switch_latest").addClass("current");jQuery("#rightbar .stories").show();if(c.content){b.html(c.content)}b.css({opacity:1})})}}});a.extend(a.ui.MiniRightbarWidget,{version:"2.0b",defaults:{controlClass:"rbc",externalElement:".rightbar_external"}})})(jQuery);(function(a){a.widget("ui.NotificationWidget",{initialize:function(){this.xhr=new XHR({klass:"notification",success:this.handleAjaxSuccess.bind(this)});this.notificationType="latest";this.registerEventHandler(this.element,"click",this.handleClick.bind(this));var c=this;jQuery("#clearNotifications").click(function(d){c.handleClick(d)});var b=jQuery("#userMenu");this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this));this.subscribeForEvent("notification.",this.notificationHandler.bind(this));this.newpost_num=0;this.postIds={top:[],top10:[],latest:[]};this.newposts=[];this.postElement=jQuery("#post_notification");this.userElement=jQuery("#user_notification");this.notifications=[];this.notificationsVisible=false;this.loadUserTemplates()},notificationHandler:function(b){switch(b.name){case"notification.togglelist":if(this.notificationsVisible===true){this.hideNotificationList()}else{this.showNotificationList()}break}},handleClick:function(h){var g=jQuery(h.target);if(g.attr("id")=="clearNotifications"){this.clearNotifications();h.preventDefault();h.stopPropagation()}else{if(g.hasClass("cn_wrap")){var f=this;var c=jQuery("#post_notification");var d={width:c.outerWidth(),height:c.outerHeight(),"margin-top":-1*c.outerHeight(true)};var b=jQuery("#post_notification_overlay").css(d).html('<img src="/assets/base.v10/img/indicator/progressIndicator_roller.gif" />');b.fadeTo(500,0.8,function(){f.showNewPosts()});h.preventDefault();h.stopPropagation()}}},handleAjaxSuccess:function(b){if(b.action=="newposts"){if(b.success){this.updateNotification(b);this.raiseEvent("notification.newpost",{data:b})}}else{if(b.action=="inflownotifications"){if(b.success){if(b.newPointer!==undefined){this.notificationsCleared()}else{if(b.items!==undefined){this.userNotificationLoaded(b)}}}}}},authEventHandler:function(b){if(this.auth.now!==undefined&&!isNaN(this.auth.now)){this.updateBase=this.auth.now;this.now=Math.round(new Date().getTime()/1000);this.setLastUpdate()}var c=this;switch(b.name){case"user.auth.success":this.getUserNotifications();break;case"user.auth.failure":this.hideNotificationList();this.clearNotificationList();break}},getUserNotifications:function(){var b={op:"commentinflow",countOnly:0,updatePointer:0,startIndex:0,r:this.auth.getRevision()};this.xhr.send("/index.php",b)},userNotificationLoaded:function(b){this.parseUserNotifications(b)},loadUserTemplates:function(){this.userTemplates={};var b=this;jQuery("#notif_templates span").each(function(){var c=jQuery(this);b.userTemplates[this.className]=c.html()})},createNotices:function(k,c,b){var g="";var h=["youAre","userName","you","time","youHave","postLink","postName","your","commentLink","messageLink"];if(!b){b=0}var d=b+c;if(d>k.length){d=k.length}for(var f=b;f<d;f++){var n=k[f];var m=this.userTemplates[n.type];for(var e=0;e<h.length;e++){var l=h[e];if(n[l]!==undefined){m=m.replace("%"+l+"%",n[l]);m=m.replace("|"+l+"|",n[l]);m=m.replace("%7C"+l+"%7C",n[l])}}g+='<div class="notice">'+m+"</div>";if(f==b+c-1&&k.length>b+c){g+='<div class="notice morelink pointer_'+f+'"><a href="#">more</a></div>';g+='<div class="notices_'+f+'" style="display: none;">';g+=this.createNotices(k,c,f+1);g+="</div>"}}return g},moreClickHandler:function(c){var b=jQuery(c.target);if(!b.hasClass("morelink")){b=b.closest(".morelink")}var d=this.getParam("pointer",b);jQuery("#userMenu div.morelink.pointer_"+d).hide();jQuery("#userMenu div.notices_"+d).show();c.stopPropagation=true;c.preventDefault=true},parseUserNotifications:function(c){var e=false;if(c.items===undefined){c.items=[]}this.notifications=c.items;if(c.items.length>0){var b=jQuery("#userNotificationContainer");b.html(this.createNotices(c.items,5));var d=this;jQuery("#userMenu div.morelink, #userMenu div.morelink a").click(function(f){d.moreClickHandler(f)});this.clearOnHide=false;jQuery("#profileNotificationCounter").html(c.items.length).show();jQuery("#clearNotifications").show()}else{jQuery("#clearNotifications").hide()}},showNotificationList:function(){var b=jQuery("#userMenu");b.show();this.notificationsVisible=true},hideNotificationList:function(){var b=jQuery("#userMenu");
b.hide();this.notificationsVisible=false},clearNotifications:function(){var b={op:"commentinflow",countOnly:1,updatePointer:1,r:this.auth.getRevision()};this.xhr.send("/index.php",b)},clearNotificationList:function(){jQuery("#userNotificationContainer").html("");jQuery("#profileNotificationCounter").hide().html("");jQuery("#clearNotifications").hide();this.notifications=[]},notificationsCleared:function(){this.hideNotificationList();this.clearNotificationList()},resetControls:function(){this.setControls()},checkNotifications:function(){if(this.notificationType=="latest"){var b={op:"ajax_remoteservice",type:"newpostd",siteId:this.options.siteId,lastUpdate:this.last_update}}},filterNotifications:function(h){var b=["top","top10","latest"];for(var d=0;d<b.length;d++){var f=b[d];var e=[];for(var c=0;c<h[f].length;c++){var g=h[f][c];if(jQuery.inArray(g,this.postIds[f])==-1){e.push(g);this.postIds[f].push(g)}}h[f]=e}return h},updateNotification:function(b){b=this.filterNotifications(b);if(b.latest.length>0){jQuery.merge(this.newposts,b.latest);this.showNewStoriesBadge(b.latest.length)}this.setLastUpdate()},showNewStoriesBadge:function(b){var c=this.controls.wrap;this.newpost_num+=b;c.html("<strong>"+this.newpost_num+" new stor"+(this.newpost_num>1?"ies":"y")+" published</strong>, click to view.");this.postElement.css("opacity",1).show()},showBreakingList:function(e){var d="";for(var c=0;c<e.posts.length;c++){var b=e.posts[c];d+='<div class="notifbadge breakingbadge"><a class="notificationControl cn_breakinglink postid_'+b.id+'" href="'+b.permalink+'"><b>Breaking</b>: '+b.title+"</a></div>"}jQuery("#breaking_notification").html(jQuery("#breaking_notification").html()+d);jQuery("#breaking_notification").show();jQuery("#breaking_notification a").bind("click",this.handleClick.bind(this))},showBreakingPost:function(d){var c=jQuery("#breaking_notification a.postid_"+d);var b=c.parents("div.breakingbadge");this.raiseEvent("navigation.setHash",{href:c.attr("href")});b.hide()},setLastUpdate:function(){this.last_update=this.updateBase+(Math.round(new Date().getTime()/1000)-this.now)},showNewPosts:function(){params={op:"newposts",ids:this.newposts};var b=this;jQuery.get("index.php",params,function(d){jQuery("#post_notification_overlay").fadeOut(500);jQuery("#post_notification").fadeOut(500);var c={data:d.content.replace("post siteid","post notificationpost siteid")};b.raiseEvent("notification.loaded",c)});this.newpost_num=0;this.newposts=[]},showMoreUserNotifications:function(){this.controls.user_header.hide();this.getUserNotifications(false)}});a.extend(a.ui.NotificationWidget,{version:"1.0",defaults:{controlClass:"notificationControl"}})})(jQuery);(function(a){a.widget("ui.PostWidget",{initialize:function(){this.processImages()},processImages:function(){var p=function(y,w,t,x){if(jQuery.data(y,"replaced")===undefined){jQuery.data(y,"replaced",true)}var A=y.width();var u=y.height();var v=y.hasClass("wide")?"":"left";if(y.hasClass("right")){v="right"}var C=y.attr("style");var B="";if(C!==undefined){var z=C.match(/top:\s*([\-0-9]+)/);if(z!==null){B+="top: "+z[1]+"px;"}z=C.match(/left\:\s*([\-0-9]+)/);if(z!==null){B+="left: "+z[1]+"px;"}z=C.match(/display\:\s*([^ ]+)/);if(z!==null){B+="display: "+z[1]+"px;"}}v+=y.hasClass("wide")?"":" editorial";if(y.css("display").toLowerCase()!=="none"){var l='<div class="lyteboxContainer '+v+'" style="'+B+"width: "+A+"px; height: "+u+'px;">';l+='<div class="lyteboxLink"><a href="'+t+'" class="noHrefOverride" rel="lytebox">Full size</a></div>';l+='<img src="'+w+'" width="'+A+'" height="'+u+'" />';l+="</div>";y.replaceWith(l)}return this};var r=function(l){var u=l.width();var t=l.height();if(!u||u>300){l.attr("width","300");if(u&&t){l.attr("height",null)}}return this};var s=this;var n=jQuery("div.post-body img, div.imgwrap.abovewrap img, img.editorial.above, div.post .illustration img");var q={};for(var k=0,g=n.length;k<g;k++){var m=jQuery(n[k]);var j=null;try{if(n[k].src){j=n[k].src}else{j=m.css("background-image").replace(/^url\((.*)\)$/,"$1")}}catch(o){}var b=null;if(j!==null){b=j.replace(/http:\/\/[^\/]+/,"")}var f=j.match(/\/(?:xlarge_|medium_)?([a-zA-Z0-9\.\_\-\%]+)$/);if(f!==null){if(q[f[1]]!==undefined){m.hide();continue}q[f[1]]=true}if(!m.hasClass("avatar")&&m.closest("div.post-body").length>0&&m.closest("div.illustration, div#gallery_container, div#thumbList, div.iconmeta").length===0){m.one("load",function(t){var l=jQuery(t.target);r(l)});if(m.complete||m.complete===undefined){m.trigger("load")}}if(m.closest("div#thumbList").length>0||jQuery(n[k]).hasClass("noLytebox")){continue}if(s.options.img_data===null||typeof s.options.img_data.lookup=="undefined"||typeof s.options.img_data.lookup[b]=="undefined"){continue}var e=s.options.img_data.lookup[b];if(s.options.img_data.data[e.pos].original.width*0.9>jQuery(n[k]).width()){var c=s.options.img_data.data[e.pos].original.url;var d=m.get(0).tagName.toLowerCase();if(d=="div"){p(m,j,c,s.options.img_data.data[e.pos][e.transform])}else{if(d=="img"){var h=function(l){var v=s.options.img_data.data[e.pos][e.transform];
var t=j;var u=c;return function(w){p(l,t,u,v)}};m.one("load",h(m));if(m.complete||m.complete===undefined){m.trigger("load")}}}}}}});a.extend(a.ui.PostWidget,{version:"1.0",defaults:{controlClass:"pic"}})})(jQuery);(function(a){a.widget("ui.PostClipWidget",{xhr:null,initialize:function(){this.xhr=new XHR({klass:"postclip",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this))},authEventHandler:function(b){switch(b.name){case"user.auth.success":this.showWidget();break;case"user.auth.failure":this.hideWidget();break}},handleClick:function(b){this.togglePostClip(jQuery(b.target));b.stopPropagation();b.preventDefault()},handleAjaxRequest:function(){},handleAjaxSuccess:function(b){jQuery(".clipid_"+b.objectId).removeClass("clip-toggle-progress");if(b.command=="tag"){jQuery(".clipid_"+b.objectId).removeClass("clip-toggle-off").addClass("clip-toggle-on").attr({title:"Un-clip this article"})}else{jQuery(".clipid_"+b.objectId).removeClass("clip-toggle-on").addClass("clip-toggle-off").attr({title:"Clip this article"});jQuery("#event_"+b.objectId).fadeOut()}},handleAjaxFail:function(){jQuery(".clip-toggle-progress").removeClass("clip-toggle-progress")},togglePostClip:function(b){var c={op:"saveusertag",objectType:"POST",objectId:this.getParam("clipid",b)};if(b.hasClass("clip-toggle-on")){c.unTagName="favorite"}else{c.tagName="favorite"}if(this.controls.postcliptoggle){this.controls.postcliptoggle.addClass("clip-toggle-progress")}this.xhr.send("/",c)},hideWidget:function(){if(this.controls.postcliptoggle){this.controls.postcliptoggle.hide()}},showWidget:function(){if(this.auth.authenticated&&this.auth.user.clipped&&this.controls.postcliptoggle){this.controls.postcliptoggle.removeClass("clip-toggle-on").addClass("clip-toggle-off").attr({title:"Clip this article"});for(var c=0,b=this.auth.user.clipped.length;c<b;c++){jQuery(".clipid_"+this.auth.user.clipped[c]).removeClass("clip-toggle-off").addClass("clip-toggle-on").attr({title:"Un-clip this article"})}this.controls.postcliptoggle.show()}},resetWidget:function(){}});a.extend(a.ui.PostClipWidget,{version:"1.0",defaults:{action_url:"/index.php",controlClass:"postclipcontrol"}})})(jQuery);(function(a){a.widget("ui.PresenceWidget",{validator:null,xhr:null,initialize:function(){this.jwindow=jQuery(window);this.xhr=new XHR({klass:"presence",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});this.registerEventHandler(this.element,"click",this.handleClicks.bind(this));var b={};if(this.controls.login_form){b.login={el:this.controls.login_dialog,focus:this.controls.username};this.login_validator=new Validator(jQuery.extend({},{scope:this.controls.login_form}));this.registerEventHandler(this.controls.login_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.login_form,"submit",this.handleLoginSubmit.bind(this))}if(this.controls.resetpw_form){b.resetpw={el:this.controls.resetpw_dialog,focus:this.controls.resetpwemail};this.resetpw_validator=new Validator(jQuery.extend({},{scope:this.controls.resetpw_form}));this.registerEventHandler(this.controls.resetpw_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.resetpw_form,"submit",this.handleResetPasswordSubmit.bind(this))}if(this.controls.register_form){b.register={el:this.controls.register_dialog};this.register_validator=new Validator(jQuery.extend({},{scope:this.controls.register_form}));this.registerEventHandler(this.controls.register_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.register_form,"submit",this.handleRegisterSubmit.bind(this))}if(this.controls.emailreminder_form){b.emailreminder={el:this.controls.emailreminder_dialog,focus:this.controls.emailreminder_email};this.emailreminder_validator=new Validator(jQuery.extend({},{scope:this.controls.emailreminder_form}));this.registerEventHandler(this.controls.emailreminder_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.emailreminder_form,"submit",this.handleEmailReminderSubmit.bind(this))}if(this.controls.subscribe_form){b.subscribe={el:this.controls.subscribe_dialog,focus:this.controls.subscribe_email};this.subscribe_validator=new Validator(jQuery.extend({},{scope:this.controls.subscribe_form}));this.registerEventHandler(this.controls.subscribe_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.subscribe_form,"submit",this.handleSubscribeSubmit.bind(this))}if(this.controls.commentsettings_form){b.commentsettings={el:this.controls.commentsettings_dialog};this.registerEventHandler(this.controls.commentsettings_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.commentsettings_form,"submit",this.handleCommentSettingsSubmit.bind(this))
}if(this.controls.avatarupload_form){b.avatarupload={el:this.controls.avatarupload_dialog,focus:this.controls.avatarupload_file};this.avatarupload_validator=new Validator(jQuery.extend({},{scope:this.controls.avatarupload_form}));this.registerEventHandler(this.controls.avatarupload_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.avatarupload_form,"submit",this.handleAvataruploadSubmit.bind(this));GawkerClientside.callbacks=jQuery.extend((GawkerClientside.callbacks?GawkerClientside.callbacks:{}),{avatarUploadResponse:this.handleAjaxSuccess.bind(this)})}if(this.controls.profileedit_form){b.profileedit={el:this.controls.profileedit_dialog,focus:this.controls.profileedit_displayname};this.profileedit_validator=new Validator(jQuery.extend({},{scope:this.controls.profileedit_form}));this.registerEventHandler(this.controls.profileedit_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.profileedit_form,"submit",this.handleProfileeditSubmit.bind(this))}if(this.controls.editreminder_form){b.editreminder={el:this.controls.editreminder_dialog,focus:this.controls.editreminder_email};this.editreminder_validator=new Validator(jQuery.extend({},{scope:this.controls.editreminder_form}));this.registerEventHandler(this.controls.editreminder_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.editreminder_form,"submit",this.handleEditReminderSubmit.bind(this))}if(this.controls.changepassword_form){b.changepassword={el:this.controls.changepassword_dialog,focus:this.controls.changepassword_password};this.changepassword_validator=new Validator(jQuery.extend({},{scope:this.controls.changepassword_form}));this.registerEventHandler(this.controls.changepassword_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.changepassword_form,"submit",this.handleChangepasswordSubmit.bind(this))}if(this.controls.guestpanel_form){b.guestpanel={el:this.controls.guestpanel_dialog,focus:this.controls.guestpanelemail};this.guestpanel_validator=new Validator(jQuery.extend({},{scope:this.controls.guestpanel_form}));this.registerEventHandler(this.controls.guestpanel_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.guestpanel_form,"submit",this.handleGuestPanelSubmit.bind(this))}if(this.controls.deleteuser_form){b.deleteuser={el:this.controls.deleteuser_dialog};this.registerEventHandler(this.controls.deleteuser_form,"submit",this.handleDeleteUserSubmit.bind(this))}this.commondialogs.initDialogs({overlay:this.controls.overlay,panels:b,group:this.options.dialoggroup?this.options.dialoggroup:false});this.resetWidget();this.openAfterLogin=null;this.dialogHandler=0;this.subscribeForEvent("presence.requiredialog",this.dialogEventHandler.bind(this));this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this));this.subscribeForEvent("presence.requiresequence.",this.sequenceHandler.bind(this));this.subscribeForEvent("dialog.beforeOpen.resetpw",this.resetResetPwDialog.bind(this));this.subscribeForEvent("dialog.beforeOpen.changepassword",this.resetChangePasswordDialog.bind(this))},dialogEventHandler:function(c){var d=this;var b=this.dialogHandler;switch(c.params.mode){case"register":this.dialogHandler=function(){var e=c.params.hash.split("|");if(e.length>1&&d.controls.register_invitecode){d.controls.register_invitecode.val(e[1]);if(e.length>2){if(e[2]=="a"){d.controls.register_copy.html("Registering will give you a star user profile with the ability to comment immediately. You will also be able to add other users as friends.")}else{if(e[2]=="s"){d.controls.register_copy.html("Registering will give you a user profile with the ability to comment immediately. You will also be able to add other users as friends.")}}}}d.commondialogs.toggleDialog({which:"register"})};break;case"login":this.dialogHandler=function(){d.commondialogs.toggleDialog({which:"login"})};break;case"resetpassword":this.dialogHandler=function(){d.commondialogs.toggleDialog({which:"resetpw"})};break;case"logout":this.dialogHandler=function(){d.mystate="loggedin:logging_out:clicked";d.xhr.send(d.options.logout_action_url,{})};break;case"profileedit":this.dialogHandler=function(){d.commondialogs.toggleDialog({which:"profileedit"})};break;case"deleteuser":this.dialogHandler=function(){if(d.auth.authenticated){d.commondialogs.toggleDialog({which:"deleteuser",cancel:function(){location.hash=""}})}};break}if(typeof(this.dialogHandler)=="function"&&b==-1){this.dialogHandler();this.dialogHandler=-1}},authEventHandler:function(h){var e=this.inState("init");var f=12;var g=jQuery(".mainProfileControls");g.hide();switch(h.name){case"user.auth.success":if(this.controls.profile_link){var d=this.auth.user.smartName;if(this.auth.user.smartName.length>f){d=this.auth.user.smartName.substr(0,f)+"..."}d+='<span id="profileNotificationCounter" class="site-bg-color" style="display:none"></span>';this.controls.profile_link.attr("href","/me").html(d)}if(!e){this.fireEvent("onLoginPanelHide",this);
this.syncEffect({el:this.controls.login_panel,fn:"hide"})}this.syncEffect({el:this.controls.profile_panel,fn:"show"});this.mystate="loggedin";if(this.controls.profilepagecontrols){var b=this.getParam("uid",this.controls.profilepagecontrols);if(this.auth.user.id===b){g.show();if(!this.auth.user.fb_uid&&this.controls.main_changepassword_link){this.controls.main_changepassword_link.show()}if(!this.auth.user.fb_uid&&this.controls.main_deleteuser_link){this.controls.main_deleteuser_link.show()}if(this.auth.hasLevel("authors")){if(this.auth.user.twitter_id){this.controls.linktwitter_link.hide();this.controls.unlinktwitter_link.show()}else{this.controls.linktwitter_link.show()}this.checkOAuth()}this.controls.profilepagecontrols.show();this.setupProfileForms()}else{this.controls.profilepagecontrols.hide();this.controls.linktwitter_link.hide();this.controls.unlinktwitter_link.hide();this.controls.main_changepassword_link.hide()}}if(this.auth.hasLevel("authors")){Debug.enable()}if(typeof(this.openAfterLogin)=="function"){this.syncEffect({el:this.commondialogs,fn:"toggleDialog",params:{which:this.openAfterLogin(this.auth.user),sync_this:this.syncEffect.bind(this)}});this.openAfterLogin=null}else{if(this.auth.showNonAsciiNotification!==undefined&&this.auth.showNonAsciiNotification===true){if(this.auth.user.emailuser){this.syncEffect({el:this.commondialogs,fn:"toggleDialog",params:{which:"resetpw",sync_this:this.syncEffect.bind(this)}})}else{this.syncEffect({el:this.commondialogs,fn:"toggleDialog",params:{which:"changepassword",sync_this:this.syncEffect.bind(this)}})}}}break;case"user.auth.failure":jQuery("#mustaddemail").remove();jQuery("#profileClickMode").html("presence");this.fireEvent("onLoginPanelShow",this,true);this.syncEffect({el:this.controls.login_panel,fn:"show"});this.mystate="loggedout:no_dialog";if(this.controls.profilepagecontrols){if(this.controls.main_changepassword_link){this.controls.main_changepassword_link.hide()}if(this.controls.main_deleteuser_link){this.controls.main_deleteuser_link.hide()}this.controls.profilepagecontrols.hide();this.controls.profileedit_contactname[0].disabled=true;this.controls.profileedit_contactname_panel.hide();this.controls.profileedit_contactemail[0].disabled=true;this.controls.profileedit_contactemail_panel.hide()}if(this.options.loginNeeded==true){this.commondialogs.toggleDialog({which:"login"})}break}if(typeof(this.dialogHandler)=="function"){this.dialogHandler()}this.dialogHandler=-1;if(e&&window.location.hash.length>0){var c=window.location.hash.split("|");if(c.length>1){this.raiseEvent("presence.requiredialog",{mode:c[1],hash:window.location.pathname})}}if(initiateLogin==true){this.commondialogs.toggleDialog({which:"login"})}if(pageType=="frontpage"){jQuery.cookie("ad_url_visited_"+this.auth.site.canonicalHost.replace(/\./,"_"),"true",{expires:2592000,path:"/"})}},sequenceHandler:function(b){switch(b.name){case"presence.requiresequence.fblogin":this.triggerFBLogin();break;case"presence.requiresequence.login":this.commondialogs.toggleDialog({which:"login"});break;case"presence.requiresequence.register":this.commondialogs.toggleDialog({which:"register"});break;case"presence.requiresequence.resetpw":this.commondialogs.toggleDialog({which:"resetpw"});break;case"presence.requiresequence.guest":this.commondialogs.toggleDialog({which:"guestpanel"});break}},resetChangePasswordDialog:function(b){this.handleNoAsciiMessage("#noAsciiNotifyChangePassword")},resetResetPwDialog:function(b){if(this.recaptchaKey===undefined){this.recaptchaKey=jQuery("#resetPwRecaptcha").html()}this.handleNoAsciiMessage("#noAsciiNotify");Recaptcha.create(this.recaptchaKey,"resetPwRecaptcha");jQuery("#resetPassword1").show();jQuery("#resetPassword2").hide();this.controls.resetpwemail.val("")},handleNoAsciiMessage:function(b){if(this.auth!==undefined&&this.auth.showNonAsciiNotification!==undefined&&this.auth.showNonAsciiNotification===true){jQuery(b).show();this.xhr.send("/?op=ajax_nonasciinotified");this.auth.showNonAsciiNotification=false}else{jQuery(b).hide()}},handleClicks:function(d){var b=this.getParam("cn",d.target);var c=false;switch(b){case"login_oauth":var g=this.getParam("type",d.target);this.oauthLogin(g);break;case"fb_login":c=true;this.triggerFBLogin();break;case"login_cancel":this.xhr.abort();case"togglelogindialog":c=true;if(this.inState("loggedout:no_dialog")){this.resetWidget()}this.commondialogs.toggleDialog({which:"login"});break;case"logout_link":c=true;this.mystate="loggedin:logging_out:clicked";this.xhr.send(this.options.logout_action_url,{});jQuery("#userMenu").hide();this.controls.loginmessage.html("");break;case"resetpw_submit":this.controls.resetpw_form.submit();break;case"toggleresetpwdialog":case"resetpw_cancel":c=true;this.commondialogs.toggleDialog({which:"resetpw"});break;case"register_submit":this.controls.register_form.submit();break;case"toggleregisterdialog":case"register_cancel":c=true;this.commondialogs.toggleDialog({which:"register"});break;case"emailreminder_cancel":c=true;
this.controls.emailreminder_noemail.val(1);this.controls.emailreminder_form.submit();break;case"togglesubscribedialog":case"subscribe_cancel":c=true;this.commondialogs.toggleDialog({which:"subscribe"});break;case"togglecommentsettingsdialog":case"commentsettings_cancel":c=true;this.commondialogs.toggleDialog({which:"commentsettings"});break;case"toggleprofileeditdialog":case"profileedit_cancel":c=true;this.commondialogs.toggleDialog({which:"profileedit"});break;case"editreminder_cancel":c=true;this.controls.editreminder_noemail.val(1);this.controls.editreminder_form.submit();break;case"togglechangepassworddialog":case"changepassword_cancel":c=true;if(this.auth.user){if(this.auth.user.emailuser){this.commondialogs.toggleDialog({which:"resetpw"})}else{this.commondialogs.toggleDialog({which:"changepassword"})}}else{this.openAfterLogin=function(e){if(e.emailuser){return"resetpw"}return"changepassword"};this.commondialogs.toggleDialog({which:"login"})}break;case"toggledeleteuserdialog":case"deleteuser_cancel":c=true;if(this.auth.user){this.commondialogs.toggleDialog({which:"deleteuser"})}else{this.openAfterLogin=function(e){return"deleteuser"};this.commondialogs.toggleDialog({which:"login"})}break;case"toggleavataruploaddialog":case"avatarupload_cancel":c=true;this.commondialogs.toggleDialog({which:"avatarupload"});break;case"linktwitter":case"unlinktwitter":this.linkTwitter(b=="linktwitter");break;case"guestpanel_cancel":this.commondialogs.toggleDialog({which:"guestpanel"});break;case"profile_link":c=true;this.raiseEvent("notification.togglelist");break;case"dialog":var f=this.getParam("dialog",d.target);window.location.hash=window.location.hash+"|"+f;this.raiseEvent("presence.requiredialog",{mode:f,hash:window.location.pathname+window.location.search});break}if(c){d.stopPropagation();d.preventDefault()}},triggerFBLogin:function(){FB.Bootstrap.requireFeatures(["Connect"],function(){FB.Connect.requireSession(function(){this.mystate="loggedout:login_dialog_active:request_sent";this.auth.fbWhenReady(function(){this.xhr.send(this.options.facebook_action_url,{action:"loginOrRegister"})}.bind(this))}.bind(this),true)}.bind(this));this.disableInputs("login")},oauthLogin:function(c){var b="/index.php?op=ajax_oauth_init&type="+c.replace(/[^a-z]/,"");window.open(b,"","width=900,height=500");var e=this;var d=function(){var g="fetchUserState=1";if(document.cookie.indexOf(g)!=-1){e.commondialogs.toggleDialog({which:e.commondialogs.groups["default"].state.replace("active:","")});var h=new Date();document.cookie=g+";expires="+h.toGMTString()+";;";var f="redirectToProfilePage=1";if(document.cookie.indexOf(f)!=-1){document.cookie=f+";expires="+h.toGMTString()+";;";window.location="/me#|profileedit"}else{e.auth.getUserState()}}else{setTimeout(d,200)}};d()},linkTwitter:function(c){this.xhr.send("/index.php?op=ajax_twitter",{action:(c?"link":"unlink"),callback:location.href});this.controls.linktwitter_link.hide();this.controls.unlinktwitter_link.hide();var b="Connecting to twitter...";if(!c){b="Removing twitter related data..."}this.controls.twitterlinkmsg.html(" | "+b);this.controls.twitterlinkmsg.show()},checkOAuth:function(){if(location.search){var e=location.search.substr(1).split("&");var h={};for(var c=0;c<e.length;c++){var d=e[c].split("=",2);h[d[0]]=decodeURIComponent(d[1])}var b=["oauth_session","oauth_verifier"];var g={action:"saveLink",callback:location.href};for(var c=0;c<b.length;c++){if(!h[b[c]]){g=null;break}g[b[c]]=h[b[c]]}if(g){this.controls.linktwitter_link.hide();this.controls.unlinktwitter_link.hide();var f=" | Saving twitter related data...";this.controls.twitterlinkmsg.html(f);this.controls.twitterlinkmsg.show();this.xhr.send("/index.php?op=ajax_twitter",g)}}},handleKeyUp:function(b){switch(b.keyCode){case jQuery.ui.keyCode.ESCAPE:this.commondialogs.toggleDialog();break}},handleLoginSubmit:function(b){b.stopPropagation();b.preventDefault();this.login_validator.hideErrors();if(this.login_validator.validate()){this.mystate="loggedout:login_dialog_active:request_sent";this.xhr.send(this.options.login_action_url,this.controls.login_form.serialize());this.disableInputs("login")}else{if(this.options.show_validation_errors){this.login_validator.showErrors()}}},handleResetPasswordSubmit:function(b){b.stopPropagation();b.preventDefault();this.resetpw_validator.hideErrors();if(this.resetpw_validator.validate()){this.mystate="loggedout:resetpw_dialog_active:request_sent";this.xhr.send(this.options.resetpw_action_url,this.controls.resetpw_form.serialize());this.disableInputs("resetpw")}else{if(this.options.show_validation_errors){this.resetpw_validator.showErrors()}}},handleRegisterSubmit:function(b){b.stopPropagation();b.preventDefault();this.register_validator.hideErrors();if(this.register_validator.validate()){if(this.controls.register_email[0].value==""){this.commondialogs.toggleDialog({which:"emailreminder"})}else{this.mystate="loggedout:register_dialog_active:request_sent";this.xhr.send(this.options.register_action_url,this.controls.register_form.serialize());
this.disableInputs("register")}}else{if(this.options.show_validation_errors){this.register_validator.showErrors()}}},handleEmailReminderSubmit:function(b){b.stopPropagation();b.preventDefault();this.emailreminder_validator.hideErrors();if(this.emailreminder_validator.validate()||this.controls.emailreminder_noemail.val()==1){this.mystate="loggedout:emailreminder_dialog_active:request_sent";this.xhr.send(this.options.register_action_url,this.controls.emailreminder_form.serialize());this.disableInputs("emailreminder")}else{if(this.options.show_validation_errors){this.emailreminder_validator.showErrors()}}},handleSubscribeSubmit:function(b){this.subscribe_validator.hideErrors();if(!this.subscribe_validator.validate()){b.stopPropagation();b.preventDefault();if(this.options.show_validation_errors){this.subscribe_validator.showErrors()}}else{this.fireEvent("onSubscribeRequestSent",this);var c=this;window.setTimeout(function(){c.disableInputs("subscribe")},300)}},handleCommentSettingsSubmit:function(b){b.stopPropagation();b.preventDefault();this.mystate="loggedin:commentsettings_dialog_active:request_sent";this.xhr.send(this.options.setprofile_action_url,this.controls.commentsettings_form.serialize());this.disableInputs("commentsettings")},handleAvataruploadSubmit:function(b){this.avatarupload_validator.hideErrors();if(!this.avatarupload_validator.validate()){b.stopPropagation();b.preventDefault();if(this.options.show_validation_errors){this.avatarupload_validator.showErrors()}}else{this.mystate="loggedin:avatarupload_dialog_active:avatar_request_sent";if(this.controls.avatarupload_indicator){this.controls.avatarupload_indicator.show()}this.fireEvent("onAvataruploadRequestSent",this);var c=this;window.setTimeout(function(){c.disableInputs("avatarupload")},300)}},handleProfileeditSubmit:function(b){b.stopPropagation();b.preventDefault();this.profileedit_validator.hideErrors();if(this.profileedit_validator.validate()){if(this.controls.profileedit_email[0].value==""){this.controls.editreminder_displayName[0].value=this.controls.profileedit_displayname[0].value;this.controls.editreminder_url[0].value=this.controls.profileedit_url[0].value;this.controls.editreminder_aimname[0].value=this.controls.profileedit_aimname[0].value;this.commondialogs.toggleDialog({which:"editreminder"})}else{this.mystate="loggedin:profileedit_dialog_active:request_sent";this.xhr.send(this.options.setprofile_action_url,this.controls.profileedit_form.serialize());this.disableInputs("profileedit")}}else{if(this.options.show_validation_errors){this.profileedit_validator.showErrors()}}},handleEditReminderSubmit:function(b){b.stopPropagation();b.preventDefault();this.editreminder_validator.hideErrors();if(this.editreminder_validator.validate()||this.controls.editreminder_noemail.val()==1){this.mystate="loggedin:editreminder_dialog_active:request_sent";this.xhr.send(this.options.setprofile_action_url,this.controls.editreminder_form.serialize());this.disableInputs("editreminder")}else{if(this.options.show_validation_errors){this.editreminder_validator.showErrors()}}},handleChangepasswordSubmit:function(b){b.stopPropagation();b.preventDefault();this.changepassword_validator.hideErrors();if(this.changepassword_validator.validate()){this.mystate="loggedin:changepassword_dialog_active:request_sent";this.xhr.send(this.options.setprofile_action_url,this.controls.changepassword_form.serialize());this.disableInputs("changepassword")}else{if(this.options.show_validation_errors){this.changepassword_validator.showErrors()}}},handleDeleteUserSubmit:function(b){b.stopPropagation();b.preventDefault();if(confirm("Are you sure you want to delete your account?")){this.mystate="loggedin:deleteuser_dialog_active:request_sent";this.xhr.send(this.options.deleteuser_action_url,this.controls.deleteuser_form.serialize());this.disableInputs("deleteuser")}},handleGuestPanelSubmit:function(c){c.stopPropagation();c.preventDefault();this.guestpanel_validator.hideErrors();if(this.guestpanel_validator.validate()){this.commondialogs.toggleDialog({});var b=false;if(this.controls.guestpanel_newsletter[0].checked){b=true}this.raiseEvent("commentform.guestsubmit",{email:this.controls.guestpanelemail.val(),newsletter:b})}else{if(this.options.show_validation_errors){this.guestpanel_validator.showErrors();this.controls.guestpanelemail.focus()}}},handleAjaxRequest:function(){if(this.inState("loggedin:logging_out:clicked")){if(this.controls.logout_indicator){this.controls.logout_indicator.show()}this.fireEvent("onLogoutRequestSent",this);this.mystate="loggedin:logging_out"}else{if(this.inState("loggedout:login_dialog_active:request_sent")){if(this.controls.login_indicator){this.controls.login_indicator.show()}this.fireEvent("onLoginRequestSent",this)}else{if(this.inState("loggedout:resetpw_dialog_active:request_sent")){if(this.controls.resetpw_indicator){this.controls.resetpw_indicator.show()}this.fireEvent("onResetPWRequestSent",this)}else{if(this.inState("loggedout:register_dialog_active:request_sent")){if(this.controls.register_indicator){this.controls.register_indicator.show()
}this.fireEvent("onRegisterRequestSent",this)}else{if(this.inState("loggedout:emailreminder_dialog_active:request_sent")){if(this.controls.emailreminder_indicator){this.controls.emailreminder_indicator.show()}this.fireEvent("onRegisterRequestSent",this)}else{if(this.inState("loggedin:commentsettings_dialog_active:request_sent")){if(this.controls.commentsettings_indicator){this.controls.commentsettings_indicator.css("display","inline")}this.fireEvent("onCommentSettingsRequestSent",this)}else{if(this.inState("loggedin:profileedit_dialog_active:request_sent")){if(this.controls.profileedit_indicator){this.controls.profileedit_indicator.show()}this.fireEvent("onProfileEditRequestSent",this)}else{if(this.inState("loggedin:editreminder_dialog_active:request_sent")){if(this.controls.editreminder_indicator){this.controls.editreminder_indicator.show()}this.fireEvent("onProfileEditRequestSent",this)}else{if(this.inState("loggedin:changepassword_dialog_active:request_sent")){if(this.controls.changepassword_indicator){this.controls.changepassword_indicator.show()}this.fireEvent("onChangePasswordRequestSent",this)}else{if(this.inState("loggedin:deleteuser_dialog_active:request_sent")){if(this.controls.deleteuser_indicator){this.controls.deleteuser_indicator.show()}this.fireEvent("onDeleteUserRequestSent",this)}}}}}}}}}}},handleAjaxSuccess:function(d){switch(d.action){case"login":case"fblogin":Message.showMessage(d.message,this.controls.loginmessage[0],{stable:true});this.enableInputs("login");if(d.success){this.auth.user=d.user;this.auth.authenticated=true;this.auth.showNonAsciiNotification=d.showNonAsciiNotification?d.showNonAsciiNotification:false;if(d.formToken){this.auth.formToken=d.formToken}this.fireEvent("onLoginSuccess",this,true);this.syncEffect({el:this.commondialogs,fn:"toggleDialog",params:{which:"login",sync_this:this.syncEffect.bind(this)}});this.resetWidget({except:"login_form"});this.syncEffect({el:this,fn:"resetWidget",params:{only:"login_form"}});this.raiseEvent("user.auth.success",d);this.auth.resetRevision()}else{if(this.controls.login_indicator){this.controls.login_indicator.hide()}this.fireEvent("onLoginFailure",this)}break;case"logout":if(d.success){this.auth.user=false;this.auth.authenticated=false;if(d.formToken){this.auth.formToken=d.formToken}this.fireEvent("onLogoutSuccess",this);this.raiseEvent("user.auth.failure",d);this.auth.resetRevision()}else{this.fireEvent("onLogoutFailure",this)}if(this.controls.logout_indicator){this.controls.logout_indicator.hide()}break;case"register":Message.showMessage(d.message,this.controls.registermessage[0]);Message.showMessage(d.message,this.controls.emailremindermessage[0]);if(this.controls.register_indicator){this.controls.register_indicator.hide()}if(this.controls.emailreminder_indicator){this.controls.emailreminder_indicator.hide()}this.enableInputs("register");this.enableInputs("emailreminder");if(d.success){this.auth.user=d.user;this.auth.authenticated=true;if(d.formToken){this.auth.formToken=d.formToken}this.fireEvent("onRegisterSuccess",this,true);this.syncEffect({el:this.commondialogs,fn:"toggleDialog",params:{which:(this.inState("loggedout:register_dialog_active:request_sent")?"register":"emailreminder"),sync_this:this.syncEffect.bind(this)}});this.resetWidget({except:"register_form"});this.resetWidget({except:"emailreminder_form"});this.syncEffect({el:this,fn:"resetWidget",params:{only:"register_form"}});this.syncEffect({el:this,fn:"resetWidget",params:{only:"emailreminder_form"}});this.raiseEvent("user.auth.success",d);this.auth.resetRevision()}else{this.fireEvent("onRegisterFailure",this)}break;case"resetpassword":if(d.success){jQuery("#resetPassword1").hide();jQuery("#resetPassword2").show();this.fireEvent("onResetPWSuccess",this)}else{this.fireEvent("onResetPWFailure",this)}Message.showMessage(d.message,this.controls.resetpwmessage[0]);if(this.controls.resetpw_indicator){this.controls.resetpw_indicator.hide()}this.enableInputs("resetpw");break;case"setprofile":if(this.inState("loggedin:changepassword_dialog_active:request_sent")){if(d.success){Message.showMessage("Password saved.",this.controls.changepassword_message[0],{stable:false});this.commondialogs.toggleDialog({which:"changepassword"})}else{Message.showMessage('<p>To protect your account\'s security, we\'ve locked the ability for this account to change passwords without email authentication.</p><p>To reset your password, please ensure that your email address is up to date in your profile, click the "reset password" link at the top of the page and enter your updated email address.</p><p>If you are still having trouble with your account, please contact us at <a href="mailto:help@gawker.com">help@gawker.com</a></p>',this.controls.changepassword_messagebig[0],{stable:true})}if(this.controls.changepassword_indicator){this.controls.changepassword_indicator.hide()}this.enableInputs("changepassword")}else{if(this.inState("loggedin:deleteuser_dialog_active:request_sent")){if(d.success){Message.showMessage("Account deleted.",this.controls.deleteuser_message[0],{stable:false});
this.commondialogs.toggleDialog({which:"deleteuser"})}else{Message.showMessage('Account deletion failed. Please contact <a href="help@gawker.com">help@gawker.com</a>',this.controls.deleteuser_messagebig[0],{stable:true})}if(this.controls.deleteuser_indicator){this.controls.deleteuser_indicator.hide()}this.enableInputs("deleteuser");if(d.success){location.href="/people/"+d.username+"#logout"}}else{if(this.inState("loggedin:profileedit_dialog_active:request_sent")||this.inState("loggedin:editreminder_dialog_active:request_sent")){if(d.success){Message.showMessage("Profile saved.",this.controls.profileedit_message[0],{stable:false});Message.showMessage("Profile saved.",this.controls.editreminder_message[0],{stable:false});this.auth.user.smartName=((d.user.smartName!==undefined)?d.user.smartName:"");this.auth.user.url=((d.user.url!==undefined)?d.user.url:"");this.auth.user.email=((d.user.email!==undefined)?d.user.email:"");this.auth.user.aimname=((d.user.aimname!==undefined)?d.user.aimname:"");if(this.controls.profileedit_extended){for(var c=0,b=this.controls.profileedit_extended.length;c<b;c++){var e=this.getParam("ext",this.controls.profileedit_extended[c]);this.auth.user[e]=this.controls.profileedit_extended.eq(c).val()}}this.commondialogs.toggleDialog({which:(this.inState("loggedin:profileedit_dialog_active:request_sent")?"profileedit":"editreminder")});this.auth.resetRevision()}else{Message.showMessage(d.message,this.controls.profileedit_message[0],{stable:false})}if(this.controls.profileedit_indicator){this.controls.profileedit_indicator.hide()}this.enableInputs("profileedit")}else{if(this.inState("loggedin:commentsettings_dialog_active:request_sent")){if(d.success){this.commondialogs.toggleDialog({which:"commentsettings"});this.auth.user.commentViewMode=d.user.commentViewMode;this.auth.user.commentRepliesMode=d.user.commentRepliesMode;this.auth.user.commentOrder=d.user.commentOrder;this.auth.resetRevision()}else{Message.showMessage("Save failed.",this.controls.commentsettings_message[0],{stable:false})}if(this.controls.commentsettings_indicator){this.controls.commentsettings_indicator.hide()}this.enableInputs("commentsettings")}}}}break;case"avatarupload":if(d.success){this.controls.profileedit_avatarimage.attr({src:d.big});this.auth.user.avatarPath=d.big;Message.showMessage(d.message,this.controls.avatarupload_message[0],{stable:false});this.mystate="loggedin:avatarupload_dialog_active";this.commondialogs.toggleDialog({which:"avatarupload"});this.auth.resetRevision();this.fireEvent("onAvataruploadSuccess",this)}else{this.fireEvent("onAvataruploadFailure",this);Message.showMessage(d.message,this.controls.avatarupload_message[0],{stable:false})}if(this.controls.avatarupload_indicator){this.controls.avatarupload_indicator.hide()}this.enableInputs("avatarupload");break;case"saveLink":case"link":if(d.success&&d.redirectUrl){location.href=d.redirectUrl}break;case"unlink":this.controls.unlinktwitter_link.hide();this.controls.linktwitter_link.show();this.controls.twitterlinkmsg.hide();break}},handleAjaxFail:function(){if(this.inState("loggedin")){if(this.inState("loggedin:logging_out")){if(this.controls.logout_indicator){this.controls.logout_indicator.hide()}this.fireEvent("onLogoutFailure",this);this.mystate="loggedin"}else{if(this.inState("loggedin:commentsettings_dialog_active:request_sent")){if(this.controls.commentsettings_indicator){this.controls.commentsettings_indicator.css("display","none")}this.fireEvent("onCommentSettingsRequestFail",this);this.mystate="loggedin:commentsettings_dialog_active"}else{if(this.inState("loggedin:profileedit_dialog_active:request_sent")){if(this.controls.profileedit_indicator){this.controls.profileedit_indicator.hide()}this.fireEvent("onProfileEditRequestFail",this);this.mystate="loggedin:profileedit_dialog_active"}else{if(this.inState("loggedout:editreminder_dialog_active:request_sent")){if(this.controls.editreminder_indicator){this.controls.editreminder_indicator.hide()}this.fireEvent("onProfileEditRequestFail",this);this.mystate="loggedout:editreminder_dialog_active"}else{if(this.inState("loggedin:changepassword_dialog_active:request_sent")){if(this.controls.changepassword_indicator){this.controls.changepassword_indicator.hide()}this.fireEvent("onChangePasswordRequestFail",this);this.mystate="loggedin:changepassword_dialog_active"}else{if(this.inState("loggedin:deleteuser_dialog_active:request_sent")){if(this.controls.deleteuser_indicator){this.controls.deleteuser_indicator.hide()}this.fireEvent("onDeleteUserRequestFail",this);this.mystate="loggedin:deleteuser_dialog_active"}}}}}}}else{if(this.inState("loggedout:login_dialog_active:request_sent")){if(this.controls.login_indicator){this.controls.login_indicator.hide()}this.fireEvent("onLoginRequestFail",this);this.mystate="loggedout:login_dialog_active";this.enableInputs("login")}else{if(this.inState("loggedout:resetpw_dialog_active:request_sent")){if(this.controls.resetpw_indicator){this.controls.resetpw_indicator.hide()}this.fireEvent("onResetPWRequestFail",this);
this.mystate="loggedout:resetpw_dialog_active";this.enableInputs("resetpw")}else{if(this.inState("loggedout:register_dialog_active:request_sent")){if(this.controls.register_indicator){this.controls.register_indicator.hide()}this.fireEvent("onRegisterRequestFail",this);this.mystate="loggedout:register_dialog_active";this.enableInputs("register")}else{if(this.inState("loggedout:emailreminder_dialog_active:request_sent")){if(this.controls.emailreminder_indicator){this.controls.emailreminder_indicator.hide()}this.fireEvent("onRegisterRequestFail",this);this.mystate="loggedout:emailreminder_dialog_active";this.enableInputs("emailreminder")}}}}}},disableInputs:function(e){switch(e){case"login":this.controls.username[0].disabled=true;this.controls.password[0].disabled=true;this.controls.login_button[0].disabled=true;break;case"resetpw":this.controls.resetpwemail[0].disabled=true;this.controls.resetpw_submit[0].disabled=true;this.controls.resetpw_cancel[0].disabled=true;break;case"register":this.controls.register_cancel[0].disabled=true;break;case"subscribe":this.controls.subscribe_email[0].disabled=true;this.controls.subscribe_submit[0].disabled=true;this.controls.subscribe_cancel[0].disabled=true;break;case"commentsettings":this.controls.commentsettings_submit[0].disabled=true;this.controls.commentsettings_cancel[0].disabled=true;this.controls.cvm_featured[0].disabled=true;this.controls.cvm_hidden[0].disabled=true;this.controls.crm_expanded[0].disabled=true;this.controls.crm_collapsed[0].disabled=true;break;case"profileedit":this.controls.profileedit_displayname[0].disabled=true;this.controls.profileedit_url[0].disabled=true;this.controls.profileedit_email[0].disabled=true;this.controls.profileedit_aimname[0].disabled=true;if(this.controls.profileedit_extended){for(var c=0,b=this.controls.profileedit_extended.length;c<b;c++){var d=this.getParam("ext",this.controls.profileedit_extended[c]);this.controls.profileedit_extended[c].disabled=true}}if(this.auth.authenticated&&this.auth.hasLevel("authors")){this.controls.profileedit_contactname[0].disabled=true;this.controls.profileedit_contactemail[0].disabled=true}this.controls.profileedit_submit[0].disabled=true;this.controls.profileedit_cancel[0].disabled=true;break;case"changepassword":this.controls.changepassword_password[0].disabled=true;this.controls.changepassword_new_password[0].disabled=true;this.controls.changepassword_confirm_password[0].disabled=true;this.controls.changepassword_submit[0].disabled=true;this.controls.changepassword_cancel[0].disabled=true;break;case"deleteuser":this.controls.deleteuser_submit[0].disabled=true;this.controls.deleteuser_cancel[0].disabled=true;break;case"avatarupload":this.controls.avatarupload_file[0].disabled=true;this.controls.avatarupload_submit[0].disabled=true;this.controls.avatarupload_cancel[0].disabled=true;break}},enableInputs:function(e){switch(e){case"login":this.controls.username[0].disabled=false;this.controls.password[0].disabled=false;this.controls.login_button[0].disabled=false;break;case"resetpw":this.controls.resetpwemail[0].disabled=false;this.controls.resetpw_submit[0].disabled=false;this.controls.resetpw_cancel[0].disabled=false;break;case"register":break;case"subscribe":this.controls.subscribe_email[0].disabled=false;this.controls.subscribe_submit[0].disabled=false;this.controls.subscribe_cancel[0].disabled=false;break;case"commentsettings":this.controls.commentsettings_submit[0].disabled=false;this.controls.commentsettings_cancel[0].disabled=false;if(this.controls.togglecommentsettingsdialog&&this.controls.togglecommentsettingsdialog[1]){this.controls.togglecommentsettingsdialog[1].disabled=false}this.controls.cvm_featured[0].disabled=false;this.controls.cvm_hidden[0].disabled=false;this.controls.crm_expanded[0].disabled=false;this.controls.crm_collapsed[0].disabled=false;break;case"profileedit":this.controls.profileedit_displayname[0].disabled=false;this.controls.profileedit_url[0].disabled=false;this.controls.profileedit_email[0].disabled=false;this.controls.profileedit_aimname[0].disabled=false;if(this.controls.profileedit_extended){for(var c=0,b=this.controls.profileedit_extended.length;c<b;c++){var d=this.getParam("ext",this.controls.profileedit_extended[c]);this.controls.profileedit_extended[c].disabled=false}}if(this.auth.authenticated&&this.auth.hasLevel("authors")){this.controls.profileedit_contactname[0].disabled=false;this.controls.profileedit_contactemail[0].disabled=false}this.controls.profileedit_submit[0].disabled=false;this.controls.profileedit_cancel[0].disabled=false;break;case"changepassword":this.controls.changepassword_password[0].disabled=false;this.controls.changepassword_new_password[0].disabled=false;this.controls.changepassword_confirm_password[0].disabled=false;this.controls.changepassword_submit[0].disabled=false;this.controls.changepassword_cancel[0].disabled=false;break;case"deleteuser":this.controls.deleteuser_submit[0].disabled=false;this.controls.deleteuser_cancel[0].disabled=false;
break;case"avatarupload":this.controls.avatarupload_file[0].disabled=false;this.controls.avatarupload_submit[0].disabled=false;this.controls.avatarupload_cancel[0].disabled=false;break}},resetWidget:function(b){if(!b){b={except:false,only:false}}else{if(!b.except){b.except=false}if(!b.only){b.only=false}}var c=b.only?true:false;switch(b.only){default:case"login_form":if(this.controls.login_form&&b.except!=="login_form"){this.controls.login_form[0].reset();this.login_validator.hideErrors();this.controls.login_indicator.hide();this.enableInputs("login")}if(c){break}case"resetpw_form":if(this.controls.resetpw_form&&b.except!=="resetpw_form"){this.controls.resetpw_form[0].reset();this.resetpw_validator.hideErrors();this.enableInputs("resetpw")}if(c){break}case"register_form":if(this.controls.register_form&&b.except!=="register_form"){this.controls.register_form[0].reset();this.register_validator.hideErrors();this.enableInputs("register")}if(c){break}case"subscribe_form":if(this.controls.subscribe_form&&b.except!=="subscribe_form"){this.controls.subscribe_form[0].reset();this.subscribe_validator.hideErrors();this.enableInputs("subscribe")}if(c){break}case"commentsettings_form":if(this.controls.commentsettings_form&&b.except!=="commentsettings_form"){this.controls.commentsettings_form[0].reset();this.enableInputs("commentsettings")}if(c){break}case"profileedit_form":if(this.controls.profileedit_form&&b.except!=="profileedit_form"){this.controls.profileedit_form[0].reset();this.enableInputs("profileedit")}if(c){break}case"avatarupload_form":if(this.controls.avatarupload_form&&b.except!=="avatarupload_form"){this.controls.avatarupload_form[0].reset();this.enableInputs("avatarupload")}if(c){break}case"changepassword_form":if(this.controls.changepassword_form&&b.except!=="changepassword_form"){this.controls.changepassword_form[0].reset();this.enableInputs("changepassword")}if(c){break}case"deleteuser_form":if(this.controls.deleteuser_form&&b.except!=="deleteuser_form"){this.controls.deleteuser_form[0].reset();this.enableInputs("deleteuser")}if(c){break}}},setupProfileForms:function(){if(this.auth.authenticated){if(this.controls.profileedit_form){this.controls.profileedit_displayname.val(this.auth.user.smartName);this.controls.profileedit_url.val(this.auth.user.url?this.auth.user.url:"");this.controls.profileedit_email.val(this.auth.user.email?this.auth.user.email:"");this.controls.profileedit_aimname.val(this.auth.user.aimname?this.auth.user.aimname:"");if(this.controls.profileedit_extended){for(var c=0,b=this.controls.profileedit_extended.length;c<b;c++){var d=this.getParam("ext",this.controls.profileedit_extended[c]);this.controls.profileedit_extended.eq(c).val(this.auth.user[d]?this.auth.user[d]:"")}}if(this.auth.hasLevel("authors")){this.controls.profileedit_contactname[0].disabled=false;this.controls.profileedit_contactname_panel.show();this.controls.profileedit_contactemail[0].disabled=false;this.controls.profileedit_contactemail_panel.show();this.controls.profileedit_contactname.val(this.auth.user.contactName?this.auth.user.contactName:"");this.controls.profileedit_contactemail.val(this.auth.user.contactEmail?this.auth.user.contactEmail:"")}else{this.controls.profileedit_contactname.val("");this.controls.profileedit_contactemail.val("");this.controls.profileedit_contactname[0].disabled=true;this.controls.profileedit_contactname_panel.hide();this.controls.profileedit_contactemail[0].disabled=true;this.controls.profileedit_contactemail_panel.hide()}}if(this.controls.avatarupload_form){if(this.controls.profileedit_avatarimage){this.controls.profileedit_avatarimage.attr({src:this.options.commenterimage_host_prefix+this.auth.user.avatarPath+this.options.commenterimage_host_postfix})}this.controls.avatarupload_authtoken.val(this.auth.user.authToken?this.auth.user.authToken:"")}if(this.controls.changepassword_form){this.controls.changepassword_username.val(this.auth.user.username);this.controls.changepassword_id.val(this.auth.user.id);this.controls.changepassword_password.val("");this.controls.changepassword_new_password.val("");this.controls.changepassword_confirm_password.val("")}if(this.controls.deleteuser_form){this.controls.deleteuser_username.val(this.auth.user.username);this.controls.deleteuser_id.val(this.auth.user.id)}if(this.controls.commentsettings_form){if(this.auth.user.commentViewMode&&this.auth.user.commentViewMode=="featured"){this.controls.cvm_hidden[0].checked="false";this.controls.cvm_featured[0].checked="true"}else{this.controls.cvm_featured[0].checked="false";this.controls.cvm_hidden[0].checked="true"}if(this.auth.user.commentRepliesMode&&this.auth.user.commentRepliesMode=="expanded"){this.controls.crm_collapsed[0].checked="false";this.controls.crm_expanded[0].checked="true"}else{this.controls.crm_expanded[0].checked="false";this.controls.crm_collapsed[0].checked="true"}if(this.auth.user.commentOrder&&this.auth.user.commentOrder=="asc"){}else{}}}}});a.extend(a.ui.PresenceWidget,{version:"1.0",defaults:{controlClass:"presence_control",selectors:{},show_validation_errors:true,isReloading:true,loginNeeded:false,facebook_action_url:"/?op=fb",login_action_url:"/?op=ajax_login",logout_action_url:"/?op=ajax_logout",register_action_url:"/?op=register",resetpw_action_url:"/?op=emailpassword",setprofile_action_url:"/?op=setprofile",deleteuser_action_url:"/?op=deleteuser",externalElement:"#presence_external_templates, .presence_control_external",commenterimage_host_prefix:"http://cache.gawkerassets.com/assets/images/commenter/",commenterimage_host_postfix:"_160.jpg",onLoginRequestSent:function(b){},onLoginRequestFail:function(b){},onLoginSuccess:function(b){if(b.options.isReloading==true){window.location.reload()
}return"will_sync"},onLoginFailure:function(b){},onLoginPanelShow:function(b){b.controls.login_panel.fadeIn(500,function(){b.syncEffect()});return"will_sync"},onLoginPanelHide:function(b){b.controls.login_panel.fadeOut(500,function(){b.syncEffect()});return"will_sync"},onLogoutRequestSent:function(b){b.controls.profile_link.html("Logging out...")},onLogoutRequestFail:function(b){b.controls.profile_link.html("Logging out...")},onLogoutSuccess:function(b){if(b.options.isReloading==true){window.location.reload()}else{b.controls.profile_panel.hide();b.controls.login_panel.show()}},onLogoutFailure:function(b){Message.showMessage("Logout failed",b.controls.logout_link[0],{nextMessage:"logout"})},onResetPWRequestSent:function(b){b.controls.resetpw_submit[0].value="Resetting..."},onResetPWRequestFail:function(b){Message.showMessage("Reset failed",b.controls.resetpw_submit[0],{nextMessage:"Reset"})},onResetPWSuccess:function(b){Message.showMessage("Password sent",b.controls.resetpw_submit[0],{nextMessage:"Reset"})},onResetPWFailure:function(b){Message.showMessage("Reset failed",b.controls.resetpw_submit[0],{nextMessage:"Reset"})},onRegisterRequestSent:function(b){b.controls.register_submit[0].value="Registering..."},onRegisterRequestFail:function(b){Message.showMessage("Register failed",b.controls.register_submit[0],{nextMessage:"Register"})},onRegisterSuccess:function(b){Message.showMessage("Done",b.controls.register_submit[0],{nextMessage:"Register"});window.setTimeout(function(){b.syncEffect()},1000);return"will_sync"},onRegisterFailure:function(b){Message.showMessage("Register failed",b.controls.register_submit[0],{nextMessage:"Register"})},onSubscribeRequestSent:function(b){b.controls.subscribe_submit[0].value="Subscribing..."},onCommentSettingsRequestSent:function(b){},onProfileeditRequestSent:function(b){b.controls.profileedit_submit[0].value="Saving profile..."},onProfileeditRequestFail:function(b){Message.showMessage("Profile save failed.",b.controls.profileedit_submit[0],{nextMessage:"Save profile"})},onProfileeditSuccess:function(b){Message.showMessage("Done",b.controls.profileedit_submit[0],{nextMessage:"Save profile"})},onProfileeditFailure:function(b){Message.showMessage("Profile save failed.",b.controls.profileedit_submit[0],{nextMessage:"Save profile"})},onChangepasswordRequestSent:function(b){b.controls.changepassword_submit[0].value="Saving password..."},onChangepasswordRequestFail:function(b){Message.showMessage("Password save failed.",b.controls.changepassword_submit[0],{nextMessage:"Save"})},onChangepasswordSuccess:function(b){Message.showMessage("Done",b.controls.changepassword_submit[0],{nextMessage:"Save"})},onChangepasswordFailure:function(b){Message.showMessage('<p>To protect your account\'s security, we\'ve locked the ability for this account to change passwords without email authentication.</p><p>To reset your password, please ensure that your email address is up to date in your profile, click the "reset password" link at the top of the page and enter your updated email address.</p><p>If you are still having trouble with your account, please contact us at <a href="mailto:help@gawker.com">help@gawker.com</a></p>',b.controls.changepassword_submit[0],{nextMessage:"Save",duration:10000})},onDeleteUserRequestSent:function(b){b.controls.deleteuser_submit[0].value="Deleting Account..."},onDeleteUserRequestFail:function(b){Message.showMessage("Account deletion failed.",b.controls.deleteuser_submit[0],{nextMessage:"Delete Account"})},onDeleteUserSuccess:function(b){Message.showMessage("Done",b.controls.changepassword_submit[0],{nextMessage:"Delete Account"})},onDeleteUserFailure:function(b){Message.showMessage('Account deletion failed. Please contact <a href="mailto:help@gawker.com">help@gawker.com</a>.',b.controls.deleteuser_submit[0],{nextMessage:"Delete Account",duration:10000})},onAvataruploadRequestSent:function(b){b.controls.avatarupload_submit[0].value="Sending image..."},onAvataruploadRequestFail:function(b){Message.showMessage("Image upload failed.",b.controls.avatarupload_submit[0],{nextMessage:"upload image"})},onAvataruploadSuccess:function(b){Message.showMessage("Done",b.controls.avatarupload_submit[0],{nextMessage:"upload image"})},onAvataruploadFailure:function(b){Message.showMessage("Image upload failed.",b.controls.avatarupload_submit[0],{nextMessage:"upload image"})}}})})(jQuery);(function(a){a.widget("ui.RepublishToolWidget",{initialize:function(){this.xhr=new XHR({klass:"republishcontrols",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});var c={};var d=false;if(this.controls.quickpost_dialog){c.quickpost={el:this.controls.quickpost_dialog,focus:this.controls.starinvite_email};d=true}if(this.controls.republish_dialog){c.republish={el:this.controls.republish_dialog,focus:this.controls.siteId};c.edit={el:this.controls.edit_dialog,focus:this.controls.siteId};this.registerEventHandler(this.controls.republish_form,"keyup",this.handleKeyUp.bind(this));
this.registerEventHandler(this.controls.republish_form,"submit",this.republish.bind(this));this.registerEventHandler(this.controls.edit_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.edit_form,"submit",this.edit.bind(this));d=true}if(d){var b={overlay:this.controls.overlay,panels:c,group:this.options.dialoggroup?this.options.dialoggroup:false};this.commondialogs.initDialogs(b)}this.bindDOMHandlers();this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this));this.subscribeForEvent("maincontent.postloaded",this.loadedEventHandler.bind(this))},bindDOMHandlers:function(){this.registerEventHandler(this.element,"click",this.handleClick.bind(this))},authEventHandler:function(b){this.setupControls()},setupControls:function(){},quickpostOpen:function(){var f=jQuery("h1.headline.title a").html();var b="";jQuery("div.post-body > p:visible").each(function(){if(b.length>0){b+="\n\n"}b+=this.innerHTML.replace(/<span\s+class="pm_byline[^"]*"[^>]*>[\w\W\n\r]*?<\/span>/,"").replace(/<br[^>]*>/ig,"\n").replace(/<[^>]*>/g,"");var g=b.split(/[\s\n\r]+/).length;if(g>100){return false}});while(b.match(/[\r\n]{3,}/g)){b=b.replace(/[\r\n]{2,}/g,"\n\n")}b=b+'\n\n<a href="'+location.href+'">'+f+"</a>";jQuery('.republish_control.cn_quickpost_dialog input[name="title"]').val(f);jQuery('.republish_control.cn_quickpost_dialog input[name="entry"]').val(b);jQuery('.republish_control.cn_quickpost_dialog input[name="url"]').val(location.href);var e=this.controls.quickpostSiteId[0];e.options.length=0;for(var d=0;d<this.options.siteIds.length;d++){if(!this.auth.hasLevel("authors",this.options.siteIds[d])){continue}var c=new Option(this.options.sites[this.options.siteIds[d]],this.options.siteIds[d]);e.options[e.options.length]=c}this.commondialogs.toggleDialog({which:"quickpost"})},quickpostSubmit:function(){var d=this.controls.quickpostSiteId[0];var b=d.options[d.selectedIndex].text;if(jQuery.inArray(b,["deadspin","fleshbot","gizmodo","io9","jalopnik","jezebel","kotaku","lifehacker","sploid"])==-1){b="gawker"}var c=this.controls.quickpostForm[0];c.action="https://publish."+b+".com/ged/index.php?op=selcont";this.commondialogs.toggleDialog({which:"quickpost"});c.submit()},loadedEventHandler:function(b){this.resetElements();this.setControls();this.bindDOMHandlers();this.setupControls()},hasLevelOnAnySite:function(e){var c=this.options.siteIds.length;var d=false;for(var b=0;b<c;b++){d=this.auth.hasLevel(e,this.options.siteIds[b]);if(d){break}}return d},handleClick:function(d){var c=this.getParam("cn",d.target);switch(c){case"republish_link":this.setupDialog();this.commondialogs.toggleDialog({which:"republish"});break;case"republish_cancel":this.commondialogs.toggleDialog({which:"republish"});break;case"republish_submit":this.controls.action.val("republish");this.republish();break;case"republish_promote":this.controls.action.val("promote");this.republish();break;case"edit_link":this.controls.postId.val(this.getParam("postId",this.controls.edit_link));var b=this.controls.edit_link.get(0);this.controls.edit_issued.val(this.getDate(this.getParam("issued",b)));this.controls.edit_pubstatus.val(this.getParam("pubstatus",b));this.commondialogs.toggleDialog({which:"edit"});break;case"edit_cancel":this.commondialogs.toggleDialog({which:"edit"});break;case"quickpostCancel":this.commondialogs.toggleDialog({which:"quickpost"});break;case"quickpostSubmit":this.quickpostSubmit();break;case"quickpost":jQuery("#editorControlsWidget").hide();this.quickpostOpen();break;default:return true}d.stopPropagation();d.preventDefault();return false},handleKeyUp:function(b){switch(b.keyCode){case jQuery.ui.keyCode.ESCAPE:this.commondialogs.toggleDialog();break}},handleAjaxRequest:function(){this.disableForm(true)},handleAjaxSuccess:function(b){this.controls.progress.hide();this.disableForm(false);var c=b.message;if(b.gedUrl!==undefined){c+=' View in <a href="'+b.gedUrl+'" target="_blank">GED</a>'}jQuery(".cn_republish_dialog button").toggleClass("hidden");this.showMessage(c,false,b.action=="edit"?"edit":"republish",true)},handleAjaxFail:function(){this.controls.progress.hide();this.disableForm(false);this.showMessage("<b>Cannot republish the post.</b> Please try again later",false)},setupDialog:function(){var b=this.controls.siteId.get(0);for(var e=b.options.length;e>0;e--){b.options[0]=null}var d=new Option("select site",-1);b.add(d,null);for(e=0;e<this.options.siteIds.length;e++){var g=this.options.siteIds[e];if(!this.auth.hasLevel("authors",g)){continue}d=new Option(this.options.sites[g],g);b.add(d,null)}var f=new Date();this.controls.postId.val(this.getParam("postId",this.controls.republish_link.get(0)));var c=this.controls.republish_link.get(0);this.controls.republish_issued.val(this.getDate(this.getParam("issued",c)));if(jQuery(".cn_republish_submit.hidden").length>0){jQuery(".cn_republish_dialog button").toggleClass("hidden")}},getDate:function(d){var c=new Date();var b=function(e){return(e<10?"0":"")+e};c.setTime(d*1000);return c.getFullYear()+"-"+b(c.getMonth()+1)+"-"+b(c.getDate())+" "+b(c.getHours())+":"+b(c.getMinutes())+":"+b(c.getSeconds())
},republish:function(d){if(d!==undefined){d.stopPropagation();d.preventDefault()}if(this.controls.siteId.val()>0){var c=this.controls.republish_form.serialize()+"&pipeJsonP=?";var b=this.options.gedUrl+"index.php?"+c;this.xhr.getJsonOwn(b);this.controls.progress.show()}else{this.showMessage("Please select site")}return false},edit:function(b){if(b!==undefined){b.stopPropagation();b.preventDefault()}this.xhr.send("/index.php",this.controls.edit_form.serialize());this.controls.progress.show()},disableForm:function(b){var c=(b==true);this.controls.siteId.get(0).disabled=c;this.controls.republish_issued.get(0).disabled=c;this.controls.republish_submit.get(0).disabled=c;this.controls.republish_cancel.get(0).disabled=c;this.controls.edit_issued.get(0).disabled=c;this.controls.edit_pubstatus.get(0).disabled=c;this.controls.edit_submit.get(0).disabled=c;this.controls.edit_cancel.get(0).disabled=c},showMessage:function(d,b,e,g){var c=this;this.controls.message.html(d).show();if(e===undefined){e="republish"}if(g===undefined){g=false}var f=function(){if(!g){c.controls.message.hide()}if(b){c.commondialogs.toggleDialog({which:e})}};setTimeout(f,3000)}});a.extend(a.ui.RepublishToolWidget,{version:"1.0",defaults:{controlClass:"republish_control",externalElement:".presence_control_external, .republish_external, #presence_external_templates",show_validation_errors:true}})})(jQuery);jQuery.extend(settings.widgets,{simpleform:{klass:"SimpleFormWidget",byselector:{"#helpMessage":{eventHandlerBuilder:function(a){return{onInit:function(b){},onHide:function(b){},onShow:function(b){},onReset:function(b){},onClick:function(b){},onAjaxSuccess:function(b){},onAjaxFailure:function(b){},onAuthEvent:function(b){},onKeyUp:function(b){}}},terminating_el:".terminating",options:{show_validation_errors:true,action_url:"/index.php",controlClass:"helpcontrol",xhrKlass:"helpmessage"}},"#share_email":{options:{externalElement:"#presence_external_templates",show_validation_errors:true,action_url:"/index.php",controlClass:"mail2control",xhrKlass:"mail2",onInit:function(c){var b={};var d=false;var a=c.widget;if(a.controls.overlay){b.mail2={el:a.controls.mail2_dialog,focus:a.controls.from};d=true}if(d){a.commondialogs.initDialogs({overlay:a.controls.overlay,panels:b,group:a.options.dialoggroup?a.options.dialoggroup:false})}a.subscribeForEvent("user.auth.",a.authEventHandler.bind(a));a.controls.title.val(document.title);a.controls.uri.val(window.location.href)},onHide:function(a){},onShow:function(a){},onReset:function(a){},onClick:function(a){var b=a.widget.getParam("cn",jQuery(a.e.target));switch(b){case"cancel":case"toggle":a.widget.controls.form[0].reset();a.widget.validator.hideErrors();a.widget.commondialogs.toggleDialog({which:"mail2"});a.e.stopPropagation();a.e.preventDefault();break}},onAjaxSuccess:function(a){if(true==a.data.success){setTimeout(function(){a.widget.commondialogs.toggleDialog({which:"mail2"})},3000)}},onAjaxFailure:function(a){},onAuthEvent:function(a){a.widget.controls.token[0].value=a.widget.auth.mail2token},onKeyUp:function(a){switch(a.e.keyCode){case jQuery.ui.keyCode.ESCAPE:a.widget.commondialogs.toggleDialog();break}}}},".surveyform":{eventHandlerBuilder:function(a){return{onInit:function(b){},onHide:function(b){},onShow:function(b){var c=b.widget.getParam("cookie");if(true==jQuery.cookie(c)){b.widget.controls.message[0].innerHTML="You took this survey earlier."}else{b.widget.controls.form.show()}},onReset:function(b){},onClick:function(b){},onAjaxSuccess:function(b){if(true==b.data.success){b.widget.controls.form.hide()}},onAjaxFailure:function(b){},onAuthEvent:function(b){},onKeyUp:function(b){}}},terminating_el:".terminating",options:{show_validation_errors:true,action_url:"/index.php",controlClass:"surveycontrol",xhrKlass:"survey"}},".guestcommentform":{eventHandlerBuilder:function(a){return{onInit:function(b){},onHide:function(b){},onShow:function(b){},onReset:function(b){jQuery(".text",b.widget.element).val("");b.widget.controls.message.html("");b.widget.element.slideUp()},onClick:function(b){var c=b.widget.getParam("cn",jQuery(b.e.target));switch(c){case"submit":b.widget.controls.form.submit();b.e.stopPropagation();b.e.preventDefault();break;case"reset":b.widget.resetWidget();b.e.stopPropagation();b.e.preventDefault();break}},onAjaxSuccess:function(b){if(true==b.data.success){setTimeout(function(){b.widget.resetWidget()},5000)}},onAjaxFailure:function(b){},onAuthEvent:function(b){},onKeyUp:function(b){}}},terminating_el:".terminating",options:{show_validation_errors:true,action_url:"/index.php",controlClass:"guestcommentcontrol",xhrKlass:"guestcomment"}}}}});(function(a){a.widget("ui.SimpleFormWidget",{validator:null,xhr:null,initialize:function(){this.registerEventHandler(this.controls.form,"submit",this.handleSubmit.bind(this));this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.registerEventHandler(this.controls.form,"keyup",this.handleKeyUp.bind(this));this.validator=new Validator(jQuery.extend({},{scope:this.controls.form}));
this.xhr=new XHR({klass:this.options.xhrKlass,beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});this.fireEvent("onInit",{widget:this})},handleSubmit:function(b){this.validator.hideErrors();if(this.validator.validate()){this.xhr.send(this.options.action_url,jQuery(b.target).serialize())}else{if(this.options.show_validation_errors){this.validator.showErrors()}}b.preventDefault();b.stopPropagation();return false},handleClick:function(b){this.fireEvent("onClick",{e:b,widget:this})},handleAjaxRequest:function(){this.disableInputs();this.controls.indicator.show()},handleAjaxSuccess:function(b){Message.showMessage(b.message,this.controls.message[0]);this.enableInputs();this.controls.indicator.hide();this.fireEvent("onAjaxSuccess",{data:b,widget:this})},handleAjaxFail:function(){var b="Error occurred, please try again later.";Message.showMessage(b,this.controls.message[0]);this.controls.indicator.hide();this.enableInputs();this.fireEvent("onAjaxFailure",{widget:this})},authEventHandler:function(b){this.fireEvent("onAuthEvent",{ev:b,widget:this})},handleKeyUp:function(b){this.fireEvent("onKeyUp",{e:b,widget:this})},hideWidget:function(){this.fireEvent("onHide",{widget:this})},showWidget:function(){this.fireEvent("onShow",{widget:this})},resetWidget:function(){this.fireEvent("onReset",{widget:this})},clearInputs:function(){jQuery("input:text, textarea",this.element).each(function(c,b){b.value=""})},disableInputs:function(){jQuery("input, textarea, select",this.element).each(function(c,b){b.disabled=true})},enableInputs:function(){jQuery("input, textarea, select",this.element).each(function(c,b){b.disabled=false})}});a.extend(a.ui.SimpleFormWidget,{version:"1.0",defaults:{}})})(jQuery);(function(a){a.widget("ui.SplashPostWidget",{initialize:function(){this.subscribeForEvent("splashpost.sponsoredpost.",this.sponsoredPostEventHandler.bind(this));if(typeof this.options.static_version=="undefined"){this.subscribeForEvent("splashpost.load",this.loadEventHandler.bind(this));jQuery().ready(function(){jQuery("#debug_server_info").html(window.ganjaHost)});this.xhr=new XHR({klass:"splashpost",success:this.handleAjaxSuccess.bind(this)});if(this.isFrontpage()){this.loadFrontpage()}}},handleAjaxSuccess:function(b){switch(b.action){case"classic_frontpage":jQuery("#post_date_views span").html("BLOG VIEW");setBodyPageType("classic_frontpage");break;case null:b.action="splash_post";b.sucess=true;break}this.raiseEvent("navigation.loaded",{data:b});jQuery("body").removeClass("loading").addClass("loaded")},loadEventHandler:function(b){this.loadFrontpage()},isFrontpage:function(){if(location.pathname!="/"&&location.pathname!=""){return false}if(location.hash==""||location.hash=="#!"){return true}if(location.hash.indexOf("!")!=1||location.hash.indexOf("#!|splash=")!=-1){return true}return false},loadFrontpage:function(){var e=false;if(location.hash.indexOf("#!|splash=")!=-1){var d=location.hash.match(/#\!\|splash=([0-9]+)/);if(d!==null){var h={op:"splash_post",refId:d[1]};this.xhr.send("/index.php",h);e=true}location.hash=""}if(!e){jQuery("body").removeClass("loaded").addClass("loading");var c=this.getUrlParams();var g=(c.sponsor_preview!==undefined?parseInt(c.sponsor_preview):0);var f=(c.adzone!==undefined?c.adzone:"");var b=this.options.contentPath;if(g||f){b="/?op=splash_post";if(g){b+="&sponsor_preview="+g}if(f){b+="&adzone="+f}b+="&pipeJsonP=splashpostloader"}this.xhr.getJsonOwn(b,"splashpostloader")}},sponsoredPostEventHandler:function(b){if(b.name=="splashpost.sponsoredpost.show"){this.displaySkybarSponsoredPost(b.params.sponsor_preview)}},pickRandomSponsoredPost:function(b){found=null;percent_sum=0;percents=[];b.each(function(c,d){sponsored_post_id=this.getParam("spid",jQuery(d));percent=this.getParam("percent",jQuery(d));if(typeof percent!="undefined"){percent=parseInt(percent,10)}else{percent=100}percent_sum+=percent;percents[c]={sponsored_post_id:sponsored_post_id,percent_sum:percent_sum}}.bind(this));percent_max=percent_sum>100?percent_sum:100;rand=Math.floor(Math.random()*percent_max);i=0;while(i<percents.length&&rand>percents[i]["percent_sum"]){i++}if(rand<=percents[i]["percent_sum"]){found=percents[i]["sponsored_post_id"]}return found},displaySkybarSponsoredPost:function(b){var j=jQuery(".sponsored_splash_post"),c=null,f=null,g=null;if(b!==false&&b!==undefined){c=j.filter(".spid_"+b);if(c.length===0){c=j.eq(0)}if(c.length===0){return true}jQuery("#sponsor_replaceable").replaceWith(c.show());try{var d=jQuery(".ad_tracker-rightbar-sp .ad_container",c).eq(0).attr("id").replace("ad_container_","");if(d){adRobot.runAdFromQueue(d)}}catch(h){}return true}g=this.pickRandomSponsoredPost(j);if(g!==null){c=j.filter(".spid_"+g);jQuery("#sponsor_replaceable").replaceWith(c.show());try{var d=jQuery(".ad_tracker-rightbar-sp .ad_container",c).eq(0).attr("id").replace("ad_container_","");if(d){adRobot.runAdFromQueue(d)}}catch(h){}}}});a.extend(a.ui.SplashPostWidget,{version:"1.0",defaults:{controlClass:"sppoc"}})
})(jQuery);
